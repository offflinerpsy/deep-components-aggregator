# üìã –ê–£–î–ò–¢–û–†–°–ö–ò–ô –û–¢–ß–Å–¢: PROD-VERIFY+SMOKE-50

**–î–∞—Ç–∞:** 25 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–í–µ—Ç–∫–∞:** `feature/prod-verify-fix`  
**GitHub:** https://github.com/offflinerpsy/deep-components-aggregator/tree/feature/prod-verify-fix  

---

## üéØ –í–´–ü–û–õ–ù–ï–ù–ù–ê–Ø –ó–ê–î–ê–ß–ê

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å–µ—Ä–≤–µ—Ä–æ–º, comprehensive test suite, AJV –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π API –∏ smoke —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º 50 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö MPN.

---

## ‚úÖ –ö–õ–Æ–ß–ï–í–´–ï –î–û–°–¢–ò–ñ–ï–ù–ò–Ø

### 1Ô∏è‚É£ **PLAYWRIGHT WEBSERVER** ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
- ‚ùå **–ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê**: ERR_CONNECTION_REFUSED –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç/—Å—Ç–æ–ø —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ `webServer` config
- ‚úÖ `reuseExistingServer: true` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ Timeout 120 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

### 2Ô∏è‚É£ **NPM-–°–ö–†–ò–ü–¢–´ "–û–î–ù–û–ô –ö–ù–û–ü–ö–û–ô"** ‚úÖ
```bash
npm run verify:prod    # –ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω —Ç–µ—Å—Ç–æ–≤
npm run verify:report  # HTML –æ—Ç—á—ë—Ç —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
```

### 3Ô∏è‚É£ **UI-–ö–û–ù–¢–†–ê–ö–¢–´ –ò –°–¢–ê–ë–ò–õ–¨–ù–´–ï –õ–û–ö–ê–¢–û–†–´** ‚úÖ
- ‚úÖ –í—Å–µ `data-testid` –∞—Ç—Ä–∏–±—É—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ Search table: `search-table`, –∫–æ–ª–æ–Ω–∫–∏ `col-*`
- ‚úÖ Product card: `gallery|meta|order|desc|docs|specs`
- ‚úÖ CSS Grid layout —Å `position: sticky` –¥–ª—è order –±–ª–æ–∫–∞

### 4Ô∏è‚É£ **COMPREHENSIVE E2E –¢–ï–°–¢–´** ‚úÖ
- ‚úÖ **Search mapping**: –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ —Ä–µ–≥–∏–æ–Ω–æ–≤/–≤–∞–ª—é—Ç
- ‚úÖ **Product layout**: Grid areas, sticky positioning, aspect-ratio
- ‚úÖ **Stability tests**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ HTTP failures
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –ª–æ–∫–∞—Ç–æ—Ä—ã**: `getByTestId` –≤–µ–∑–¥–µ

### 5Ô∏è‚É£ **AJV –í–ê–õ–ò–î–ê–¶–ò–Ø API** ‚úÖ
- ‚úÖ RU-canon —Å—Ö–µ–º—ã –¥–ª—è `/api/search` –∏ `/api/product`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è `price_rub > 0` –¥–ª—è USD/EUR –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É—Ä—Å–æ–≤ –¶–ë –†–§ (—Ä–∞–∑—É–º–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω 60-150 —Ä—É–±–ª–µ–π –∑–∞ USD)
- ‚úÖ Draft-07 schema support (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

### 6Ô∏è‚É£ **SMOKE-50 INFRASTRUCTURE** ‚úÖ
- ‚úÖ –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä 50 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö MPN
- ‚úÖ JSON –æ—Ç—á—ë—Ç –≤ `reports/smoke-50.json`
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ (status, duration, error)
- ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏: ‚â•80% success rate

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ **–£–°–ü–ï–®–ù–û (77/113 —Ç–µ—Å—Ç–æ–≤):**
- **Playwright webServer**: –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è/–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **API endpoints**: –û—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (200 OK)
- **AJV validation**: –°—Ö–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç
- **Search mapping**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- **Infrastructure**: Artifacts, traces, videos —Å–æ–±–∏—Ä–∞—é—Ç—Å—è

### ‚ùå **–ü–†–û–ë–õ–ï–ú–´ (36/113 —Ç–µ—Å—Ç–æ–≤):**
- **Smoke-50**: 0% success rate (100/100 fail)
- **Root cause**: –ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –≤ UI —Ç–µ—Å—Ç–∞—Ö
- **–î–∏–∞–≥–Ω–æ–∑**: RU-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã, –Ω–æ –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä

---

## üì¶ –ê–†–¢–ï–§–ê–ö–¢–´ –î–õ–Ø –ê–£–î–ò–¢–ê

### **–í GIT –†–ï–ü–û–ó–ò–¢–û–†–ò–ò:**
- ‚úÖ `test-results/` - **400+ —Ñ–∞–π–ª–æ–≤** traces, videos, screenshots
- ‚úÖ `playwright-report/` - **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π HTML –æ—Ç—á—ë—Ç**
- ‚úÖ `reports/smoke-50.json` - **–î–µ—Ç–∞–ª—å–Ω—ã–π JSON –æ—Ç—á—ë—Ç smoke —Ç–µ—Å—Ç–æ–≤**
- ‚úÖ `reports/sources/` - **–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ HTML –æ—Ç RU-–ø–∞—Ä—Å–µ—Ä–æ–≤**
- ‚úÖ `schemas/ru-canon.schema.json` - **AJV —Å—Ö–µ–º–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏**

### **–ö–û–ú–ê–ù–î–´ –î–õ–Ø –ê–£–î–ò–¢–û–†–ê:**
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏
git clone https://github.com/offflinerpsy/deep-components-aggregator.git
cd deep-components-aggregator
git checkout feature/prod-verify-fix

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm ci
npx playwright install --with-deps chromium

# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞
npm run verify:prod

# –ü—Ä–æ—Å–º–æ—Ç—Ä HTML –æ—Ç—á—ë—Ç–∞
npm run verify:report

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ trace
npx playwright show-trace test-results/[–ø—É—Ç—å-–∫-trace.zip]
```

### **–§–ê–ô–õ–´ –î–õ–Ø –†–ï–í–¨–Æ:**
- `playwright.config.ts` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å webServer
- `tests/e2e/search-mapping.spec.ts` - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫ –ø–æ–∏—Å–∫–∞
- `tests/e2e/product-layout.spec.ts` - Layout –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∏
- `tests/e2e/smoke-50.spec.ts` - 50 MPN smoke —Ç–µ—Å—Ç—ã
- `tests/api/api-ajv.spec.ts` - AJV –≤–∞–ª–∏–¥–∞—Ü–∏—è API
- `package.json` - –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

## üîç ROOT CAUSE ANALYSIS

### **–ü–†–û–ë–õ–ï–ú–ê:**
RU-–∞–¥–∞–ø—Ç–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã (ChipDip, Promelec, Compel, Platan, Electronshik), –Ω–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ OEMsTrade –¥–ª—è –ø–æ–∏—Å–∫–∞. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø—É—Å—Ç—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –¥–ª—è –º–Ω–æ–≥–∏—Ö MPN –≤ smoke —Ç–µ—Å—Ç–∞—Ö.

### **–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –†–ï–®–ï–ù–ò–ï:**
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å RU-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å 0% –¥–æ ‚â•80% success rate.

### **–§–ê–ô–õ–´ –ö –ò–ó–ú–ï–ù–ï–ù–ò–Æ:**
- `src/services/orchestrator.js` - –¥–æ–±–∞–≤–∏—Ç—å RU-–∞–¥–∞–ø—Ç–µ—Ä—ã
- `adapters/` - –ø–æ–¥–∫–ª—é—á–∏—Ç—å ChipDip, Promelec –∏ –¥—Ä—É–≥–∏–µ
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è: ChipDip ‚Üí Promelec ‚Üí Compel ‚Üí Platan ‚Üí Electronshik

---

## üéØ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–Å–ú–ö–ò

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| –°–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç/–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Playwright | ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û** | webServer config —Ä–∞–±–æ—Ç–∞–µ—Ç |
| Search-mapping —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ OK, –¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ |
| Product-layout —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** | Layout OK, –∫–æ–Ω—Ç–µ–Ω—Ç –ø—É—Å—Ç–æ–π |
| API-AJV —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ —Å price_rub > 0 | ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û** | –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç |
| Smoke-50: ‚â•80% success/partial | ‚ùå **0%** | –ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RU-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ |
| –ù–µ—Ç –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö | ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û** | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è chrome-extension |
| –í—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω—ã –≤ Git | ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û** | 700+ —Ñ–∞–π–ª–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ |

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### **–ü–†–ò–û–†–ò–¢–ï–¢ 1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RU-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ChipDip, Promelec, Compel –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ smoke —Ç–µ—Å—Ç–æ–≤ —Å 0% –¥–æ ‚â•80% success rate.

### **–ü–†–ò–û–†–ò–¢–ï–¢ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤**
- –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö MPN
- –î–æ–±–∞–≤–∏—Ç—å fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ä–µ–¥–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –£–ª—É—á—à–∏—Ç—å error handling –≤ smoke —Ç–µ—Å—Ç–∞—Ö

---

## üìà –ú–ï–¢–†–ò–ö–ò

- **–û–±—â–∏—Ö —Ç–µ—Å—Ç–æ–≤**: 113
- **–£—Å–ø–µ—à–Ω—ã—Ö**: 77 (68%)
- **–ü–∞–¥–∞—é—â–∏—Ö**: 36 (32%)
- **Smoke MPN –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: 50
- **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–æ**: 700+ —Ñ–∞–π–ª–æ–≤
- **–†–∞–∑–º–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**: +6.57 MB (traces, videos, JSON)
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~2 –º–∏–Ω—É—Ç—ã –ø–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞.**

Playwright webServer —Ä–µ—à–∏–ª –ø—Ä–æ–±–ª–µ–º—É ERR_CONNECTION_REFUSED, –≤—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Git, AJV –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ RU-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä, —á—Ç–æ –ª–µ–≥–∫–æ —Ä–µ—à–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —ç—Ç–∞–ø–µ.

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É –∑–∞–¥–∞—á: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RU-–∫–æ–Ω—Ç–µ–Ω—Ç–∞!** üîß

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** Claude Sonnet 4 (Principal Software Engineer)  
**–ö–æ–Ω—Ç–∞–∫—Ç:** feature/prod-verify-fix branch  
**–î–∞—Ç–∞:** 2025-09-25 19:15 MSK
