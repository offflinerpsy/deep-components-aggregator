# ЗОЛОТЫЕ ПРАВИЛА SSH В CURSOR IDE

## КРИТИЧЕСКИ ВАЖНО: Флаг -T для SSH команд

**ПРОБЛЕМА:** Без флага `-T` терминал PowerShell в Cursor IDE зависает и не завершается автоматически. Пользователю приходится вручную нажимать Cancel.

**РЕШЕНИЕ:** ВСЕГДА использовать флаг `-T` для неинтерактивных SSH команд.

## ПРАВИЛА ИСПОЛЬЗОВАНИЯ

### ✅ ПРАВИЛЬНО:
```bash
ssh -T root@89.104.69.77 "curl -s http://127.0.0.1:9201/_version"
ssh -T root@89.104.69.77 "systemctl restart deep-aggregator"
ssh -T root@89.104.69.77 "pm2 logs aggregator --nostream --lines 10"
ssh -T root@89.104.69.77 "systemctl status deep-aggregator --no-pager"
```

### ❌ НЕПРАВИЛЬНО:
```bash
ssh root@89.104.69.77 "pm2 logs aggregator"  # ЗАВИСНЕТ!
ssh root@89.104.69.77 "systemctl edit service"  # ЗАВИСНЕТ!
ssh root@89.104.69.77 "cat > file << 'EOF'"  # ЗАВИСНЕТ!
```

## СПЕЦИАЛЬНЫЕ СЛУЧАИ

### PM2 команды:
- ✅ `pm2 logs --nostream --lines 10` (завершается)
- ❌ `pm2 logs` (зависает в режиме стриминга)

### systemctl команды:
- ✅ `systemctl status --no-pager` (завершается)
- ❌ `systemctl status` (может зависнуть)

### Создание файлов:
- ✅ Использовать `scp` для готовых файлов
- ✅ Использовать `base64` для передачи контента
- ❌ Использовать `heredoc` через SSH

## ПРИМЕРЫ РЕШЕНИЙ

### Создание файла на сервере:
```bash
# Способ 1: SCP (для готовых файлов)
scp local-file.txt root@89.104.69.77:/remote/path/

# Способ 2: Base64 (для контента)
echo "file content" | base64 | ssh -T root@89.104.69.77 "base64 -d > /remote/path/file.txt"
```

### Работа с логами:
```bash
# Показать последние 10 строк и завершиться
ssh -T root@89.104.69.77 "journalctl -u deep-aggregator --lines 10 --no-pager"

# PM2 логи без зависания
ssh -T root@89.104.69.77 "pm2 logs deep-aggregator --nostream --lines 20"
```

## ТЕХНИЧЕСКОЕ ОБОСНОВАНИЕ

Флаг `-T` отключает псевдо-терминал (TTY) в SSH сессии. Это говорит SSH клиенту: "Не запрашивай интерактивный терминал, просто выполни команду и верни результат".

**Результат:** Команды выполняются и сразу завершаются, возвращая управление Cursor IDE без зависания.

## ПРОВЕРКА РАБОТЫ

После применения этих правил:
- ✅ Команды завершаются автоматически
- ✅ Не нужно нажимать Cancel
- ✅ Терминал не зависает
- ✅ Автоматизация работает стабильно

---
**СОЗДАНО:** 26 сентября 2025  
**СТАТУС:** Протестировано и работает  
**ПРИМЕНИМО:** Cursor IDE + PowerShell + SSH
