# 🎯 ЛОГИКА ПРОЕКТА DEEP AGGREGATOR - ПОЛНОЕ ТЕХЗАДАНИЕ

## 🔍 ОБЩАЯ КОНЦЕПЦИЯ

**Агрегатор электронных компонентов** - поиск по запросу → данные из разных источников → единая карточка товара → заказ через админку.

## 📊 АРХИТЕКТУРА ДАННЫХ

### 🎯 ПОИСКОВЫЙ ЗАПРОС
- Пользователь вводит: MPN, название, описание ("транзистор", "LM317", "стабилизатор")
- Запускается **параллельный парсинг** двух типов источников

### 📈 ИСТОЧНИКИ ДАННЫХ

**1. OEMsTrade (oemstrade.com) - ЦЕНЫ И ДИЛЕРЫ:**
- ✅ Цены (USD/EUR → автоконвертация в ₽)
- ✅ Регионы поставки (США, Китай, Тайвань, Европа, Азия)
- ✅ Количество в наличии
- ✅ Ссылки на дилеров (НЕ показываем клиенту!)
- ⚠️ Дилеры скрыты до момента заказа

**2. Русские сайты - ТЕХНИЧЕСКОЕ ОПИСАНИЕ:**
- 🥇 **ChipDip.ru** (приоритет #1 - самый полный)
- 🥈 **Elitan.ru** (фолбэк #1)
- 🥉 **Platan.ru** (фолбэк #2)
- 📋 Извлекаем: название, описание, характеристики, изображения, datasheet PDF

### 🔄 ЛОГИКА ФОЛБЭКОВ

```
Поиск "LM317" →
├─ OEMsTrade: цены/дилеры/регионы
└─ RU-сайты: ChipDip → Elitan → Platan → ...
   (берем первый, где есть полная карточка)
```

## 🎨 UI ВЫДАЧИ ПОИСКА

**ТАБЛИЦА (как OEMsTrade):**
```
| Фото | Наименование | Описание | Регионы/Наличие | Цена₽/Купить |
|------|-------------|----------|-----------------|---------------|
| 📷   | LM317T      | Стаб...  | USA: 1000шт     | 45₽ [Купить]  |
|      | STM         |          | CN: 500шт       |               |
```

**ЧТО ПОКАЗЫВАЕМ:**
- ✅ Цена в рублях (конвертированная)
- ✅ Регионы и количество
- ✅ Техническое описание (с русских сайтов)
- ❌ НЕ показываем названия дилеров

## 🛒 КАРТОЧКА ТОВАРА

**LAYOUT (как ChipDip):**
```
┌─────────────┬─────────────────┬─────────────┐
│   ГАЛЕРЕЯ   │   ПАСПОРТ       │   ПОКУПКА   │
│ (изображения│   - Название    │ (sticky)    │
│  + PDF)     │   - Бренд/MPN   │ - Цена ₽    │
│             │   - Описание    │ - Регионы   │
│             │                 │ - [Купить]  │
└─────────────┴─────────────────┴─────────────┘
│                                             │
│  ТЕХНИЧЕСКИЕ ХАРАКТЕРИСТИКИ                 │
│  (таблица параметров с русских сайтов)     │
└─────────────────────────────────────────────┘
```

## 🛒 ПРОЦЕСС ЗАКАЗА

**1. Клиент нажимает [Купить] → Модальное окно:**
```
┌─────────────────────────────────────┐
│ 📦 ЗАКАЗАТЬ LM317T                  │
├─────────────────────────────────────┤
│ ФИО: [________________]             │
│ Email: [______________]             │
│ Телефон: [____________]             │
│ Количество: [____] шт               │
│ Комментарий: [_________]            │
│                                     │
│ [Отправить заказ] [Отмена]          │
└─────────────────────────────────────┘
```

**2. После заказа:**
- ✅ Клиенту → email: "Заказ принят, с вами свяжутся"
- ✅ В админку → данные клиента + **ВСЕ ссылки на дилеров**

## 🔧 ТЕХНИЧЕСКАЯ РЕАЛИЗАЦИЯ

### 🌐 ПРОКСИ-СИСТЕМА
- **Локальный ПК как прокси** (MVP) → обход антиботов
- Rotation через твой компьютер для всех парсеров
- В будущем: резидентские прокси

### 🤖 ПАРСЕРЫ

**OEMsTrade парсер:**
- Cheerio + DOM анализ
- Извлечение: цены, регионы, дилеры, количество
- Конвертация валют через ЦБ РФ

**Русские парсеры:**
- **Playwright для сложных сайтов** (скриншоты + DOM)
- Приоритет ChipDip → фолбэки на другие
- Извлечение: название, описание, характеристики, изображения, PDF

### 📊 ВОРКЕРЫ (ФОНОВЫЕ ЗАДАЧИ)

**1. Дилер-воркер:**
```javascript
// scripts/workers/dealer-collector.mjs
// Собирает ~50 случайных товаров
// Извлекает ВСЕХ дилеров из OEMsTrade
// Группирует по регионам
// Сохраняет в data/dealers-map.json
```

**2. Сайт-исследователь:**
```javascript  
// scripts/workers/site-researcher.mjs
// Изучает структуру русских сайтов
// Делает скриншоты + HTML дампы
// Находит правильные CSS селекторы
// Генерирует парсеры под реальную структуру
```

**3. Тест-воркер:**
```javascript
// scripts/workers/parser-tester.mjs  
// Тестирует парсеры на 50 товарах
// Проверяет полноту извлеченных данных
// Генерирует отчеты успешности
```

## 🎛️ АДМИНКА (БУДУЩЕЕ)

**Простая админка для заказов:**
- Список заказов с данными клиентов
- Ссылки на всех дилеров по товару
- Статусы обработки заказов
- Email уведомления

## 🔄 ПОТОК ДАННЫХ

```
Клиент вводит "LM317" →
├─ Параллельно:
│  ├─ OEMsTrade парсер → цены/дилеры/регионы
│  └─ RU-парсеры → ChipDip → описание/характеристики
├─ Объединение данных → единая карточка
├─ Конвертация валют ЦБ РФ → цены в ₽
├─ Отображение в таблице (без дилеров)
└─ Клик [Купить] → модалка → админка (+ дилеры)
```

## 🚀 MVP ПЛАН РЕАЛИЗАЦИИ

**ЭТАП 1: ИССЛЕДОВАНИЕ**
1. ✅ Playwright исследование ChipDip/Elitan/Platan
2. ✅ Анализ HTML структуры, CSS селекторы
3. ✅ Тестирование на реальных товарах

**ЭТАП 2: ПАРСЕРЫ**
1. ✅ Переписать OEMsTrade парсер (уже работает)
2. 🔄 Реальные парсеры для ChipDip/Elitan/Platan
3. ✅ Интеграция с прокси-системой

**ЭТАП 3: ИНТЕГРАЦИЯ**
1. ✅ Live search с параллельными парсерами
2. ✅ Конвертация валют ЦБ РФ
3. ✅ UI таблица + карточка товара

**ЭТАП 4: ВОРКЕРЫ**
1. 🔄 Дилер-коллектор воркер
2. 🔄 Парсер-тестер воркер
3. 🔄 Автоматическое обновление данных

**ЭТАП 5: ЗАКАЗЫ**
1. 🔄 Модальное окно заказа
2. 🔄 Email система
3. 🔄 Простая админка

## 🎯 КРИТЕРИИ УСПЕХА

**Парсеры работают, если:**
- ✅ OEMsTrade: ≥90% товаров находит цены/дилеров
- ✅ ChipDip: ≥80% товаров находит полное описание
- ✅ Фолбэки: покрывают остальные 20%
- ✅ Конвертация валют: точная, актуальная
- ✅ UI: таблица отображает все данные корректно

**MVP готов, если:**
- Поиск "LM317" → полная таблица с ценами₽
- Карточка товара → вся информация + изображения
- Кнопка [Купить] → модалка заказа
- Все работает в продакшне без ошибок

---

**🎯 ГЛАВНАЯ ЦЕЛЬ:** Сделать агрегатор, который РЕАЛЬНО РАБОТАЕТ с живыми данными, а не заглушками!
