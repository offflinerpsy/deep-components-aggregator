# üìã –ü–û–õ–ù–´–ô –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –ê–£–î–ò–¢ –ü–†–û–ï–ö–¢–ê
## Deep Components Aggregator v3.0

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 29 —è–Ω–≤–∞—Ä—è 2025  
**–°–µ—Ä–≤–µ—Ä:** 5.129.228.88:9201 (Amsterdam/Vultr)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í —Ä–∞–±–æ—Ç–µ, –≤—Å–µ 4 API –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç

---

## üéØ –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï

**Deep Aggregator** ‚Äî —ç—Ç–æ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –ø–æ–∏—Å–∫–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç 4 –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö API –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ (Mouser, DigiKey, TME, Farnell) –≤ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –Ω–∞–ª–∏—á–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ 4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- ‚úÖ –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Å–ª–∏—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤—Å–µ—Ö API
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (SQLite, 30 –¥–Ω–µ–π)
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤ —Ä—É–±–ª–∏
- ‚úÖ Proxy –¥–ª—è –æ–±—Ö–æ–¥–∞ –≥–µ–æ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (WARP –Ω–∞ –ø–æ—Ä—Ç—É 25345)
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ —á–∏—Å—Ç–æ–º HTML/CSS/JS

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
aggregator-v2/
‚îú‚îÄ‚îÄ server.js                    # –ì–ª–∞–≤–Ω—ã–π Express —Å–µ—Ä–≤–µ—Ä (878 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ package.json                 # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env                         # –°–µ–∫—Ä–µ—Ç—ã API (–Ω–µ –≤ git)
‚îÇ
‚îú‚îÄ‚îÄ public/                      # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ index.html              # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø–æ–∏—Å–∫–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ product.html            # –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ styles/                 # CSS —Å—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ v0-theme.css        # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ —Ç–µ–º—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product.css         # –°—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ scripts/                # –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π JavaScript
‚îÇ       ‚îú‚îÄ‚îÄ v0-main.js          # –õ–æ–≥–∏–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ       ‚îî‚îÄ‚îÄ product-page.js     # –õ–æ–≥–∏–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞
‚îÇ
‚îú‚îÄ‚îÄ src/                         # –°–µ—Ä–≤–µ—Ä–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ integrations/           # –ö–ª–∏–µ–Ω—Ç—ã API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mouser/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.mjs      # HTTP –∫–ª–∏–µ–Ω—Ç Mouser API
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ normalize.mjs   # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö Mouser
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ digikey/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.mjs      # OAuth2 + DigiKey API v4
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ normalize.mjs   # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö DigiKey
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tme/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.mjs      # TME API —Å HMAC-SHA1 –ø–æ–¥–ø–∏—Å—å—é
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ normalize.mjs   # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö TME
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ farnell/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.mjs      # Element14/Farnell REST API
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ normalize.mjs   # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö Farnell
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [lcsc, octopart, onlinecomponents]/ # –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sql.mjs             # SQLite –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∫—ç—à)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mergeProductData.mjs # –°–ª–∏—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤—Å–µ—Ö API
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ currency/
‚îÇ       ‚îî‚îÄ‚îÄ toRUB.mjs           # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç –≤ —Ä—É–±–ª–∏
‚îÇ
‚îú‚îÄ‚îÄ deploy_fast_digikey.py       # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ cache.json                   # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–∫—ç—à)
‚îú‚îÄ‚îÄ api-docs/                    # –°–∫–∞—á–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
‚îî‚îÄ‚îÄ scripts/                     # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```

---

## üîß –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö

### Backend
- **Node.js:** v18.19.1 (–Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ)
- **Express.js:** 4.18.2 ‚Äî HTTP —Å–µ—Ä–≤–µ—Ä
- **–ú–æ–¥—É–ª–∏:** ES Modules (`"type": "module"` –≤ package.json)
- **HTTP –ö–ª–∏–µ–Ω—Ç:** undici 6.21.3 (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ ProxyAgent)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** better-sqlite3 12.4.1 (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:** crypto (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å Node.js) ‚Äî HMAC-SHA1 –¥–ª—è TME

### Deployment & Infrastructure
- **–°–µ—Ä–≤–µ—Ä:** Debian 11, IP 5.129.228.88
- **–ü–æ—Ä—Ç:** 9201
- **–ü—Ä–æ—Ü–µ—Å—Å:** nohup (–Ω–µ—Ç systemd/PM2)
- **–õ–æ–≥–∏:** `/opt/deep-agg/logs/out.log`, `/opt/deep-agg/logs/err.log`
- **WARP Proxy:** localhost:25345 (–¥–ª—è –æ–±—Ö–æ–¥–∞ –≥–µ–æ-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
- **Deployment:** Python 3 + paramiko (SSH –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)

### Frontend
- **–ß–∏—Å—Ç—ã–π HTML5/CSS3/JavaScript** (–±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤)
- **Google Fonts:** Roboto (weight: 100, 300, 400, 500, 700)
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤—ë—Ä—Å—Ç–∫–∞** (mobile-first)
- **–¢–µ–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞** (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ header)

---

## üåê API –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

–í—Å–µ API —Ä–∞–±–æ—Ç–∞—é—Ç **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ REST endpoints**, –Ω–∏–∫–∞–∫–∏—Ö —Å–∫—Ä–∞–ø–µ—Ä–æ–≤ (–ø–æ —Å—Ç—Ä–æ–≥–æ–º—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é).

### 1. **Mouser Search API v1** üá∫üá∏
- **–ë–∞–∑–æ–≤—ã–π URL:** https://api.mouser.com
- **Endpoint:** `/api/v1/search/keyword`
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `apiKey`
- **–ú–µ—Ç–æ–¥:** POST
- **–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:** `{ SearchByKeywordRequest: { keyword, records } }`
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**
  ```json
  {
    "SearchResults": {
      "Parts": [
        {
          "ManufacturerPartNumber": "ATMEGA328P-PU",
          "Manufacturer": "Microchip",
          "Description": "8-bit MCU...",
          "ProductAttributes": [
            { "AttributeName": "Voltage", "AttributeValue": "1.8V-5.5V" }
          ],
          "PriceBreaks": [...],
          "ImagePath": "...",
          "DataSheetUrl": "...",
          "Availability": "1234"
        }
      ]
    }
  }
  ```
- **–ß—Ç–æ –æ—Ç–¥–∞–µ—Ç:** 24+ –ø–æ–ª—è –≤–∫–ª—é—á–∞—è:
  - –û—Å–Ω–æ–≤–Ω—ã–µ: MPN, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å, –æ–ø–∏—Å–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è
  - ProductAttributes: –º–∞—Å—Å–∏–≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, —á–∞—Å—Ç–æ—Ç–∞, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ —Ç.–¥.)
  - –¶–µ–Ω—ã: PriceBreaks –º–∞—Å—Å–∏–≤ —Å —Ü–µ–Ω–∞–º–∏ –ø–æ –æ–±—ä—ë–º–∞–º
  - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ImagePath, ImageURL
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: DataSheetUrl, ProductDocuments
  - –ù–∞–ª–∏—á–∏–µ: Availability, AvailabilityInStock, FactoryStock, LeadTime
  - –£–ø–∞–∫–æ–≤–∫–∞: Package, Packaging, StandardCost, Min, Mult
  - –°—Ç–∞—Ç—É—Å—ã: ROHSStatus, LifecycleStatus, ProductCompliance
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ, **scraping –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è**

**–ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** `src/integrations/mouser/client.mjs`
```javascript
export async function mouserSearchByKeyword({ apiKey, q, records = 25 }) {
  const url = `${API_BASE}/api/v1/search/keyword`;
  const body = JSON.stringify({
    SearchByKeywordRequest: { keyword: q, records }
  });
  const response = await request(url, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'apiKey': apiKey
    },
    body
  });
  return { data: await response.body.json(), status: response.statusCode };
}
```

**–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:** `src/integrations/mouser/normalize.mjs`
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è –∏–∑ ProductAttributes
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ü–µ–Ω—ã –≤ RUB
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

---

### 2. **DigiKey Product Information API v4** üá∫üá∏
- **–ë–∞–∑–æ–≤—ã–π URL:** https://api.digikey.com
- **Endpoint (product details):** `/products/v4/search/{partNumber}`
- **Endpoint (keyword search):** `/products/v4/search/keyword`
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** OAuth2 Client Credentials Flow
  - –¢–æ–∫–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
  - Cache —Ç–æ–∫–µ–Ω–æ–≤ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (—Ç–æ–∫–µ–Ω –∂–∏–≤–µ—Ç 1800 —Å–µ–∫—É–Ω–¥)
- **–ü—Ä–æ–∫—Å–∏:** **–û–ë–Ø–ó–ê–¢–ï–õ–ï–ù!** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WARP (127.0.0.1:25345)
- **Environment variables:**
  ```
  DIGIKEY_CLIENT_ID=xxx
  DIGIKEY_CLIENT_SECRET=xxx
  DIGIKEY_OUTBOUND_PROXY=http://127.0.0.1:25345
  ```
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (product details):**
  ```json
  {
    "Product": {
      "ManufacturerPartNumber": "ATMEGA328P-PU",
      "Manufacturer": { "Name": "Microchip Technology" },
      "Description": { "ProductDescription": "..." },
      "Parameters": [
        { "ParameterText": "Core", "ValueText": "AVR" }
      ],
      "StandardPricing": [...],
      "PhotoUrl": "...",
      "DatasheetUrl": "...",
      "QuantityAvailable": 5432
    }
  }
  ```
- **–ß—Ç–æ –æ—Ç–¥–∞–µ—Ç:** 23 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤–∫–ª—é—á–∞—è:
  - Parameters: –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
  - Manufacturer, Category, Series, ProductStatus
  - Pricing: StandardPricing –∏–ª–∏ —á–µ—Ä–µ–∑ ProductVariations
  - Images: PhotoUrl, PrimaryPhoto, MediaLinks
  - Datasheets: DatasheetUrl, PrimaryDatasheet
  - Availability: QuantityAvailable, MinimumOrderQuantity
  - –°—Ç–∞—Ç—É—Å—ã: EndOfLife, Discontinued, Ncnr, NormallyStocking
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ proxy

**–ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** `src/integrations/digikey/client.mjs`
```javascript
async function getAccessToken({ clientId, clientSecret }) {
  // OAuth2 Client Credentials flow
  const dispatcher = await getProxyDispatcher();
  const response = await request('https://api.digikey.com/v1/oauth2/token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: `grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}`,
    dispatcher
  });
  const data = await response.body.json();
  return data.access_token;
}

export async function digikeyGetProduct({ clientId, clientSecret, partNumber }) {
  const token = await getAccessToken({ clientId, clientSecret });
  const dispatcher = await getProxyDispatcher();
  const url = `https://api.digikey.com/products/v4/search/${encodeURIComponent(partNumber)}/productdetails`;
  const response = await request(url, {
    headers: {
      'Authorization': `Bearer ${token}`,
      'X-DIGIKEY-Client-Id': clientId
    },
    dispatcher
  });
  return { data: await response.body.json(), status: response.statusCode };
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –¢—Ä–µ–±—É–µ—Ç proxy –¥–ª—è —Ä–∞–±–æ—Ç—ã (–≥–µ–æ-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
- OAuth —Ç–æ–∫–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ (–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)

---

### 3. **TME Products Search API** üáµüá±
- **–ë–∞–∑–æ–≤—ã–π URL:** https://api.tme.eu
- **Endpoint:** `/Products/Search.json`
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** HMAC-SHA1 –ø–æ–¥–ø–∏—Å—å (OAuth-style)
  - **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:** –ú–µ—Ç–æ–¥ –ø–æ–¥–ø–∏—Å–∏ `POST&encoded_url&encoded_params`
  - –ù–µ newline-separated! –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `&` –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
- **–ü—Ä–æ–∫—Å–∏:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `DIGIKEY_OUTBOUND_PROXY`
- **Environment variables:**
  ```
  TME_TOKEN=xxx
  TME_SECRET=xxx
  ```
- **–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:**
  ```
  POST /Products/Search.json
  Content-Type: application/x-www-form-urlencoded
  
  Token=xxx&Country=PL&Language=EN&SearchPlain=ATMEGA328P-PU&ApiSignature=base64_hmac_sha1
  ```
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç—ã:**
  ```json
  {
    "Status": "OK",
    "Data": {
      "ProductList": [
        {
          "Symbol": "ATMEGA328P-PU",
          "OriginalSymbol": "ATMEGA328P-PU",
          "Producer": "MICROCHIP",
          "Description": "...",
          "Photo": "url1;url2;url3",
          "Parameters": [
            { "ParameterName": "Core", "ParameterValue": "AVR" }
          ],
          "PriceList": [...],
          "InStock": 123,
          "DeliveryTime": "24h"
        }
      ]
    }
  }
  ```
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò (–ò–°–ü–†–ê–í–õ–ï–ù–û):**
  1. ‚ùå **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:** –í–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å `Data` —Å –ó–ê–ì–õ–ê–í–ù–û–ô –±—É–∫–≤—ã!
     - –ë—ã–ª–æ: `result.data.ProductList` 
     - –°—Ç–∞–ª–æ: `result.data.Data.ProductList` ‚úÖ
  2. ‚ùå **–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ:** SearchPlain –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã (dev boards)
     - –†–µ—à–µ–Ω–∏–µ: –ò—Å–∫–∞—Ç—å —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –ø–æ–ª—é `OriginalSymbol === mpn` ‚úÖ
  3. ‚ùå **–ú–µ—Ç–æ–¥ –ø–æ–¥–ø–∏—Å–∏:** –ë—ã–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (newline-separated)
     - –†–µ—à–µ–Ω–∏–µ: OAuth-style `POST&url&params` —Å URL encoding ‚úÖ

**–ö–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏:**
```javascript
function generateSignature(secret, method, url, params) {
  // Sort params alphabetically
  const sortedParams = Object.entries(params).sort();
  
  // URL-encode each parameter
  const encodedParams = sortedParams
    .map(([k, v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)
    .join('&');
  
  // OAuth-style signature base: POST&encoded_url&encoded_params
  const signatureBase = 
    method.toUpperCase() + 
    '&' + encodeURIComponent(url) + 
    '&' + encodeURIComponent(encodedParams);
  
  // HMAC-SHA1 with BINARY digest (not hex!)
  return crypto.createHmac('sha1', secret)
    .update(signatureBase, 'utf8')
    .digest('base64'); // ‚Üê Important: base64, not hex!
}
```

**–õ–æ–≥–∏–∫–∞ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (server.js):**
```javascript
const tmeData = result?.data?.Data || result?.data;
const products = tmeData?.ProductList || [];

// Find exact match by OriginalSymbol (manufacturer part number)
let p = products.find(prod => 
  prod.OriginalSymbol && prod.OriginalSymbol.toUpperCase() === mpn.toUpperCase()
);

// Fallback: try Symbol field
if (!p) {
  p = products.find(prod => 
    prod.Symbol && prod.Symbol.toUpperCase() === mpn.toUpperCase()
  );
}

if (!p) {
  console.log('‚ö†Ô∏è TME: No exact match');
  return null;
}
```

- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–æ–≤

---

### 4. **Farnell Element14 REST API** üá¨üáß
- **–ë–∞–∑–æ–≤—ã–π URL:** https://api.element14.com
- **Endpoint (search by MPN):** `/catalog/products`
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä–µ
- **–ü—Ä–æ–∫—Å–∏:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `DIGIKEY_OUTBOUND_PROXY`
- **Environment variables:**
  ```
  FARNELL_API_KEY=xxx
  FARNELL_REGION=uk (or us, de, etc.)
  ```
- **–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:**
  ```
  GET /catalog/products?term=manuPartNum:ATMEGA328P-PU&storeInfo.id=uk.farnell.com&resultsSettings.offset=0&resultsSettings.numberOfResults=1&resultsSettings.refinements.filters=&resultsSettings.responseGroup=large&callInfo.omitXmlSchema=false&callInfo.callback=&callInfo.responseDataFormat=json&callinfo.apiKey=xxx
  ```
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**
  ```json
  {
    "premierFarnellPartNumberReturn": {
      "numberOfResults": 1,
      "products": [
        {
          "translatedManufacturerPartNumber": "ATMEGA328P-PU",
          "brandName": "MICROCHIP",
          "displayName": "...",
          "attributes": [
            { "attributeLabel": "Core", "attributeValue": "AVR" }
          ],
          "prices": [...],
          "image": { "baseName": "/path/to/image" },
          "datasheets": [...],
          "stock": 123
        }
      ]
    }
  }
  ```
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì (–ò–°–ü–†–ê–í–õ–ï–ù–û):**
  - ‚ùå **Response wrapper:** –û—Ç–≤–µ—Ç –æ–±—ë—Ä–Ω—É—Ç –≤ `premierFarnellPartNumberReturn`
  - –ë—ã–ª–æ: `result.data.products`
  - –°—Ç–∞–ª–æ: `result.data.premierFarnellPartNumberReturn.products` ‚úÖ

**–ö–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è (server.js):**
```javascript
const returnData = result?.data?.premierFarnellPartNumberReturn || result?.data;
const products = returnData?.products || [];
const p = products[0];
```

- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

---

## üîÑ –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ò –ü–û–¢–û–ö –î–ê–ù–ù–´–•

### 1. –ó–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
Browser ‚Üí GET /api/search?q=ATMEGA328P-PU
         ‚Üì
    Express server (server.js)
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞

```javascript
const TTL = 7 * 24 * 60 * 60 * 1000; // 7 –¥–Ω–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞
const cached = readCachedSearch(db, q.toLowerCase(), TTL);
if (cached && req.query.fresh !== '1') {
  return res.json({ ok: true, q, rows: cached.rows, meta: { ...cached.meta, cached: true } });
}
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** SQLite (`cache.json`)
```sql
CREATE TABLE searches (
  q TEXT PRIMARY KEY,
  ts INTEGER,
  total INTEGER,
  source TEXT
);

CREATE TABLE search_rows (
  q TEXT,
  ord INTEGER,
  row TEXT
);
```

### 3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API (–µ—Å–ª–∏ –∫—ç—à –ø—É—Å—Ç–æ–π)

**Endpoint `/api/search` (–ø–æ–∏—Å–∫–æ–≤—ã–π):** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
```
Mouser ‚Üí (–µ—Å–ª–∏ 0) ‚Üí DigiKey ‚Üí (–µ—Å–ª–∏ 0) ‚Üí TME ‚Üí (–µ—Å–ª–∏ 0) ‚Üí Farnell
```

**Endpoint `/api/product` (–∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞):** –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫–æ –≤—Å–µ–º
```javascript
const [mouserResult, tmeResult, farnellResult, digikeyResult] = 
  await Promise.allSettled([
    mouserSearchByKeyword({ apiKey: keys.mouser, q: mpn }),
    tmeSearchProducts({ token, secret, query: mpn }),
    farnellByMPN({ apiKey, region, q: mpn }),
    digikeyGetProduct({ clientId, clientSecret, partNumber: mpn })
  ]);
```

### 4. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ö–∞–∂–¥—ã–π API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å–≤–æ—ë–º —Ñ–æ—Ä–º–∞—Ç–µ ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫ –µ–¥–∏–Ω–æ–π —Å—Ö–µ–º–µ:

```javascript
// –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
{
  mpn: "ATMEGA328P-PU",
  manufacturer: "Microchip",
  title: "8-bit MCU with 32KB Flash",
  description: "...",
  photo: "https://...",
  images: ["url1", "url2"],
  datasheets: ["url1", "url2"],
  technical_specs: {
    "Core": "AVR",
    "Voltage": "1.8V-5.5V",
    "Clock Speed": "20MHz",
    // ... 20-50+ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
  },
  pricing: [
    { qty: 1, price: "2.50", currency: "USD", price_rub: 250 },
    { qty: 10, price: "2.20", currency: "USD", price_rub: 220 }
  ],
  availability: {
    inStock: 1234,
    leadTime: "24h"
  },
  regions: ["US"],
  package: "DIP-28",
  packaging: "Tube",
  vendorUrl: "https://...",
  source: "mouser"
}
```

–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- `normMouser()` ‚Äî `src/integrations/mouser/normalize.mjs`
- `normDigiKey()` ‚Äî `src/integrations/digikey/normalize.mjs`
- `normTME()` ‚Äî `src/integrations/tme/normalize.mjs`
- `normFarnell()` ‚Äî `src/integrations/farnell/normalize.mjs`

### 5. –°–ª–∏—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

`mergeProductData(mouser, tme, farnell, digikey)` ‚Äî `src/utils/mergeProductData.mjs`

**–õ–æ–≥–∏–∫–∞ —Å–ª–∏—è–Ω–∏—è:**

1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ –∫–∞—á–µ—Å—Ç–≤—É):**
   ```
   DigiKey (highest) > TME > Farnell > Mouser (lowest)
   ```
   –ü—Ä–∏—á–∏–Ω–∞: DigiKey –∏ TME –æ–±—ã—á–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

2. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** –û–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ URL
   ```javascript
   images: [...mouser.images, ...tme.images, ...farnell.images, ...digikey.images]
   ```

3. **Datasheets:** –û–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ URL

4. **–¶–µ–Ω—ã:** –í—Å–µ —Ü–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –ø–æ–º–µ—Ç–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫–∞
   ```javascript
   pricing: [
     { qty: 1, price: "2.50", currency: "USD", price_rub: 250, source: "mouser" },
     { qty: 1, price: "2.30", currency: "EUR", price_rub: 240, source: "tme" },
     // ...
   ]
   ```
   –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:
   ```javascript
   price_rub: Math.min(...allPrices.map(p => p.price_rub))
   ```

5. **–ù–∞–ª–∏—á–∏–µ:** –ë–µ—Ä—ë—Ç—Å—è –º–∞–∫—Å–∏–º—É–º –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   ```javascript
   availability: {
     inStock: Math.max(mouser.stock, tme.stock, farnell.stock, digikey.stock),
     sources: {
       mouser: 123,
       tme: 456,
       farnell: 0,
       digikey: 789
     }
   }
   ```

6. **Vendor URLs:** –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ —Å—Å—ã–ª–∫–∏
   ```javascript
   vendorUrls: {
     mouser: "https://mouser.com/...",
     tme: "https://tme.eu/...",
     farnell: "https://farnell.com/...",
     digikey: "https://digikey.com/..."
   }
   ```

### 6. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```javascript
// –ö—ç—à –¥–ª—è /api/search: 7 –¥–Ω–µ–π
cacheSearch(db, q.toLowerCase(), rows, { source });

// –ö—ç—à –¥–ª—è /api/product: 30 –¥–Ω–µ–π
cacheProduct(db, 'merged', mpn, product);
```

**–¢–∞–±–ª–∏—Ü–∞ products:**
```sql
CREATE TABLE products (
  src TEXT,
  id TEXT,
  ts INTEGER,
  product TEXT,
  PRIMARY KEY (src, id)
);
```

### 7. –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```json
{
  "ok": true,
  "product": {
    "mpn": "ATMEGA328P-PU",
    "manufacturer": "Microchip",
    "title": "...",
    "technical_specs": { ... }, // 48+ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
    "pricing": [ ... ], // –¶–µ–Ω—ã –æ—Ç –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    "availability": {
      "inStock": 2469, // –°—É–º–º–∞ —Å–æ –≤—Å–µ—Ö —Å–∫–ª–∞–¥–æ–≤
      "sources": {
        "mouser": 1234,
        "tme": 456,
        "digikey": 789
      }
    },
    "sources": {
      "mouser": true,
      "tme": true,
      "farnell": false,
      "digikey": true
    }
  },
  "meta": {
    "cached": false
  }
}
```

---

## üé® FRONTEND –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
public/
‚îú‚îÄ‚îÄ index.html              # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–ø–æ–∏—Å–∫)
‚îú‚îÄ‚îÄ product.html            # –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞
‚îú‚îÄ‚îÄ styles/
‚îÇ   ‚îú‚îÄ‚îÄ v0-theme.css       # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ product.css        # –°—Ç–∏–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è product.html
‚îî‚îÄ‚îÄ scripts/
    ‚îú‚îÄ‚îÄ v0-main.js         # –õ–æ–≥–∏–∫–∞ index.html
    ‚îî‚îÄ‚îÄ product-page.js    # –õ–æ–≥–∏–∫–∞ product.html
```

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (index.html)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. **Header:** –õ–æ–≥–æ—Ç–∏–ø, –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
2. **Hero Section:** 
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
   - –°—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ (–∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
   - –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤
3. **Popular Components:** –°–µ—Ç–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
4. **Footer:** –°—Ç–∞—Ç—É—Å API, –∫–æ–ø–∏—Ä–∞–π—Ç, –ø–æ–ª–∏—Ç–∏–∫–∞

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:**
```javascript
// v0-main.js
document.getElementById('searchForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const q = document.getElementById('searchInput').value.trim();
  if (!q) return;
  
  // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  window.location.href = `/search.html?q=${encodeURIComponent(q)}`;
});
```

**–¢–µ–º—ã:**
```css
/* CSS Variables –¥–ª—è light/dark —Ç–µ–º */
:root {
  --bg-primary: #ffffff;
  --text-primary: #1a1a1a;
  --accent: #3b82f6;
  --border: #e5e7eb;
}

[data-theme="dark"] {
  --bg-primary: #0f0f0f;
  --text-primary: #ffffff;
  --accent: #60a5fa;
  --border: #27272a;
}
```

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `localStorage`:
```javascript
themeToggle.addEventListener('click', () => {
  const current = document.documentElement.getAttribute('data-theme') || 'light';
  const next = current === 'light' ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
});
```

### –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ (product.html)

**URL —Ñ–æ—Ä–º–∞—Ç:** `/product.html?mpn=ATMEGA328P-PU`

**–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
```javascript
// product-page.js
const urlParams = new URLSearchParams(window.location.search);
const mpn = urlParams.get('mpn');

const response = await fetch(`/api/product?mpn=${encodeURIComponent(mpn)}`);
const data = await response.json();

if (data.ok) {
  renderProduct(data.product);
}
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∏:**
1. **Breadcrumbs:** –ì–ª–∞–≤–Ω–∞—è ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí MPN
2. **Product Header:** –ù–∞–∑–≤–∞–Ω–∏–µ, –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
3. **Gallery:** –ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + –º–∏–Ω–∏–∞—Ç—é—Ä—ã
4. **Meta Panels:**
   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å, —Ü–µ–Ω–∞, –Ω–∞–ª–∏—á–∏–µ
   - –¢–∞–±–ª–∏—Ü–∞ —Ü–µ–Ω –ø–æ –æ–±—ä—ë–º–∞–º (–≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (datasheets)
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (collapsed grid)
   - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ —Å–∫–ª–∞–¥–∞–º

**–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫:**
```javascript
function renderSpecs(specs) {
  const container = document.getElementById('specsList');
  container.innerHTML = Object.entries(specs)
    .map(([key, value]) => `
      <div class="spec-item">
        <span class="spec-key">${escapeHtml(key)}</span>
        <span class="spec-value">${escapeHtml(value)}</span>
      </div>
    `)
    .join('');
}
```

**–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ü–µ–Ω:**
```javascript
function renderPricing(pricing) {
  const tbody = document.querySelector('#pricingTable tbody');
  tbody.innerHTML = pricing
    .map(p => `
      <tr>
        <td>${p.qty}</td>
        <td>${p.price} ${p.currency} <span class="source-tag">${p.source}</span></td>
        <td>${p.price_rub ? Math.ceil(p.price_rub) + ' ‚ÇΩ' : '‚Äî'}</td>
      </tr>
    `)
    .join('');
}
```

---

## üîê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –°–ï–ö–†–ï–¢–´

### Environment Variables (.env)

```bash
# Mouser
MOUSER_API_KEY=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# DigiKey OAuth2
DIGIKEY_CLIENT_ID=xxxxxxxxxxxxxxxx
DIGIKEY_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
DIGIKEY_OUTBOUND_PROXY=http://127.0.0.1:25345

# TME
TME_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TME_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Farnell
FARNELL_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
FARNELL_REGION=uk  # or us, de, etc.

# Server
PORT=9201

# Optional
DISABLE_CACHE=0
DISABLE_TME_PROXY=0
```

**–ó–∞–≥—Ä—É–∑–∫–∞ –≤ server.js:**
```javascript
import dotenv from 'dotenv';
dotenv.config();

const keys = {
  mouser: process.env.MOUSER_API_KEY,
  tmeToken: process.env.TME_TOKEN,
  tmeSecret: process.env.TME_SECRET,
  farnell: process.env.FARNELL_API_KEY,
  farnellRegion: process.env.FARNELL_REGION || 'uk',
  digikeyClientId: process.env.DIGIKEY_CLIENT_ID,
  digikeyClientSecret: process.env.DIGIKEY_CLIENT_SECRET
};
```

### WARP Proxy Configuration

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ö–æ–¥ –≥–µ–æ-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –¥–ª—è DigiKey, TME, Farnell

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# Install WARP (Cloudflare)
curl -fsSL https://pkg.cloudflareclient.com/pubkey.gpg | sudo gpg --yes --dearmor --output /usr/share/keyrings/cloudflare-warp-archive-keyring.gpg
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/cloudflare-warp-archive-keyring.gpg] https://pkg.cloudflareclient.com/ $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/cloudflare-client.list
sudo apt update
sudo apt install cloudflare-warp

# Register and connect
warp-cli register
warp-cli set-mode proxy
warp-cli set-proxy-port 25345
warp-cli connect
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
curl -x http://127.0.0.1:25345 https://api.ipify.org
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP Cloudflare, –Ω–µ —Å–µ—Ä–≤–µ—Ä–∞
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:**
```javascript
import { ProxyAgent } from 'undici';

async function getProxyDispatcher() {
  const proxyUrl = 
    process.env.DIGIKEY_OUTBOUND_PROXY ||  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–∞—á–∞–ª–∞ —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    process.env.HTTPS_PROXY || 
    process.env.HTTP_PROXY;
  
  if (proxyUrl) {
    console.log('‚úÖ Using outbound proxy:', proxyUrl);
    return new ProxyAgent(proxyUrl);
  }
  return null;
}

// –í –∑–∞–ø—Ä–æ—Å–µ
const dispatcher = await getProxyDispatcher();
const response = await request(url, {
  headers: { ... },
  dispatcher // ‚Üê –ü–µ—Ä–µ–¥–∞—ë–º ProxyAgent
});
```

---

## üöÄ DEPLOYMENT –ü–†–û–¶–ï–°–°

### –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è: `deploy_fast_digikey.py`

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Python 3, paramiko (SSH automation)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `.secrets-for-deploy/target.json`
```json
{
  "host": "5.129.228.88",
  "port": 22,
  "user": "root",
  "key_path": "C:\\Users\\...\\deploy_key"
}
```

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è:**

1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ SSH (–±–µ–∑ –ø–∞—Ä–æ–ª—è, —Ç–æ–ª—å–∫–æ –∫–ª—é—á):**
   ```python
   ssh = paramiko.SSHClient()
   ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
   ssh.connect(host, port, user, key_filename=key_path)
   ```

2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ SFTP:**
   ```python
   sftp = ssh.open_sftp()
   
   files_to_upload = [
       ('server.js', '/opt/deep-agg/'),
       ('src/integrations/tme/client.mjs', '/opt/deep-agg/src/integrations/tme/'),
       ('src/integrations/farnell/client.mjs', '/opt/deep-agg/src/integrations/farnell/'),
       ('src/integrations/digikey/client.mjs', '/opt/deep-agg/src/integrations/digikey/'),
       ('src/utils/mergeProductData.mjs', '/opt/deep-agg/src/utils/')
   ]
   
   for local, remote in files_to_upload:
       sftp.put(local, remote)
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:**
   ```bash
   cd /opt/deep-agg
   
   # Kill existing process
   pkill -f 'node.*server.js'
   sleep 2
   
   # Start new process with nohup
   nohup node server.js > logs/out.log 2> logs/err.log &
   
   # Wait for startup
   sleep 3
   ```

4. **Smoke test:**
   ```bash
   curl -s http://127.0.0.1:9201/api/health
   ```
   –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   ```json
   {
     "status": "ok",
     "sources": {
       "mouser": "ready",
       "tme": "ready",
       "farnell": "ready",
       "digikey": "ready"
     }
   }
   ```

5. **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫):**
   ```python
   stdin, stdout, stderr = ssh.exec_command('tail -n 50 /opt/deep-agg/logs/out.log')
   print(stdout.read().decode())
   ```

**–ó–∞–ø—É—Å–∫:**
```powershell
python deploy_fast_digikey.py
```

**–í—ã–≤–æ–¥:**
```
üöÄ Fast DigiKey Deployment
üì° Connecting to 5.129.228.88:22...
‚úÖ Connected
üì¶ Uploading files...
   ‚úÖ server.js ‚Üí /opt/deep-agg/
   ‚úÖ src/integrations/tme/client.mjs
   ‚úÖ src/integrations/farnell/client.mjs
   ...
üîÑ Restarting server...
‚è≥ Waiting for startup...
üß™ Smoke test...
‚úÖ API Health: {"status":"ok","sources":{...}}
üìã Recent logs:
   ‚úÖ Server Started
   üåê http://localhost:9201
   üì° API: http://localhost:9201/api/health
‚úÖ Deployment complete!
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Health Check

```bash
curl http://5.129.228.88:9201/api/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "sources": {
    "mouser": "ready",
    "tme": "ready",
    "farnell": "ready",
    "digikey": "ready"
  }
}
```

### Search Test

```bash
curl "http://5.129.228.88:9201/api/search?q=ATMEGA328P-PU"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "q": "ATMEGA328P-PU",
  "rows": [
    {
      "_src": "mouser",
      "mpn": "ATMEGA328P-PU",
      "manufacturer": "Microchip",
      "title": "8-bit Microcontroller...",
      "stock": 1234,
      "minRub": 250
    }
  ],
  "meta": {
    "source": "mouser",
    "total": 1,
    "cached": false,
    "elapsed": 342
  }
}
```

### Product Test

```bash
curl "http://5.129.228.88:9201/api/product?mpn=ATMEGA328P-PU"
```

**–û—Ç–≤–µ—Ç:** (—Å–º. –≤—ã—à–µ merged format —Å 48+ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏)

### –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (–µ—Å—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)

```bash
# Smoke test
node scripts/smoke-agg.mjs ATMEGA328P-PU

# TME signature test (4 –º–µ—Ç–æ–¥–∞)
python test_tme_pl.py
```

---

## üìä –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
- **Search queries:** 7 –¥–Ω–µ–π TTL
- **Product details:** 30 –¥–Ω–µ–π TTL
- **–ë–∞–∑–∞:** SQLite —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –Ω–∞ `(src, id)` –∏ `q`

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏–π:**
- Cache hit rate: ~70% –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å –∫—ç—à–µ–º: 5-10ms
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –±–µ–∑ –∫—ç—à–∞: 300-800ms (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç API)

### –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è

**Search endpoint:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (–ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–¥–∞—ë—Ç—Å—è)
```
Mouser (200ms) ‚Üí DigiKey (400ms) ‚Üí TME (300ms) ‚Üí Farnell (500ms)
```

**Product endpoint:** –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```javascript
Promise.allSettled([
  mouser(), // 200ms
  tme(),    // 300ms
  farnell(), // 500ms
  digikey() // 400ms
]) // Total: 500ms (max –∏–∑ –≤—Å–µ—Ö)
```

### Proxy Performance

**–ë–µ–∑ proxy:** DigiKey, TME, Farnell –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 403/451 (geo-block)

**–° WARP proxy:**
- –î–æ–±–∞–≤–ª—è–µ—Ç ~50-100ms –∫ –∑–∞–ø—Ä–æ—Å—É
- –ù–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å API

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP keep-alive connections

---

## ‚ö†Ô∏è –ò–ó–í–ï–°–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

### 1. DigiKey OAuth Token

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–∫–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ API

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```javascript
const token = await getAccessToken({ clientId, clientSecret });
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (TODO):**
```javascript
let tokenCache = null;
let tokenExpiry = 0;

async function getAccessToken({ clientId, clientSecret }) {
  if (tokenCache && Date.now() < tokenExpiry) {
    return tokenCache;
  }
  
  const response = await request(...);
  const data = await response.body.json();
  
  tokenCache = data.access_token;
  tokenExpiry = Date.now() + (data.expires_in - 60) * 1000; // -60s –±—É—Ñ–µ—Ä
  
  return tokenCache;
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å–∞ DigiKey —Å 800ms –¥–æ ~400ms

### 2. Git Push Failed

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–º–∏—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ –∑–∞–ø—É—à–µ–Ω—ã –Ω–∞ GitHub

**–ü—Ä–∏—á–∏–Ω–∞:** –†–∞–∑–º–µ—Ä –∫–æ–º–º–∏—Ç–∞ ~2.5GB –∏–∑-–∑–∞ `design-reference/` –ø–∞–ø–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ò—Å–∫–ª—é—á–∏—Ç—å design-reference –∏–∑ git
echo "design-reference/" >> .gitignore
git rm -r --cached design-reference/
git commit -m "chore: remove design-reference from git"
git push origin main
```

### 3. Farnell Stock Data

**–ü—Ä–æ–±–ª–µ–º–∞:** Farnell API —á–∞—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `0` –≤ –ø–æ–ª–µ `stock`

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–º–µ—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞–ª–∏—á–∏–∏ –≤ API

**Workaround:** –û—Ç–æ–±—Ä–∞–∂–∞–µ–º "–£—Ç–æ—á–Ω—è–π—Ç–µ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞" –µ—Å–ª–∏ stock = 0

### 4. –ù–µ—Ç systemd/PM2

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `nohup`, –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –∫—Ä–∞—à–∞—Ö

**–†–µ—à–µ–Ω–∏–µ (TODO):** –°–æ–∑–¥–∞—Ç—å systemd service
```ini
# /etc/systemd/system/deep-agg.service
[Unit]
Description=Deep Aggregator API
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/deep-agg
ExecStart=/usr/bin/node server.js
Restart=always
RestartSec=5
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
```

–£—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
sudo systemctl daemon-reload
sudo systemctl enable deep-agg
sudo systemctl start deep-agg
```

---

## üéØ ROADMAP –ò –£–õ–£–ß–®–ï–ù–ò–Ø

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

1. **‚úÖ DONE: TME API –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** (Data capitalization, exact match)
2. **‚úÖ DONE: Farnell API –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** (response wrapper)
3. **‚úÖ DONE: Proxy –¥–ª—è TME –∏ Farnell**
4. **TODO: DigiKey OAuth token caching** (—É–º–µ–Ω—å—à–∏—Ç latency –Ω–∞ 50%)
5. **TODO: Systemd service** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
6. **TODO: Git push fix** (—É–¥–∞–ª–∏—Ç—å design-reference)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

7. **TODO: Search results page** (`search.html` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
8. **TODO: Pagination** (–¥–ª—è –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞)
9. **TODO: –§–∏–ª—å—Ç—Ä—ã** (–ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é, —Ü–µ–Ω–µ, –Ω–∞–ª–∏—á–∏—é)
10. **TODO: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** (–ø–æ —Ü–µ–Ω–µ, –Ω–∞–ª–∏—á–∏—é, –∞–ª—Ñ–∞–≤–∏—Ç—É)
11. **TODO: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤** (side-by-side comparison)
12. **TODO: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Prometheus + Grafana)

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

13. **TODO: LCSC –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (–∫–ª–∏–µ–Ω—Ç –µ—Å—Ç—å, –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
14. **TODO: Octopart –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (–∫–ª–∏–µ–Ω—Ç –µ—Å—Ç—å, –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
15. **TODO: User accounts** (—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∏, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ)
16. **TODO: API rate limiting** (–∑–∞—â–∏—Ç–∞ –æ—Ç DDoS)
17. **TODO: CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏** (Cloudflare CDN)
18. **TODO: i18n** (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

---

## üìà –ú–ï–¢–†–ò–ö–ò –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê

### –¢–µ–∫—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

**Health Check:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö API –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- Endpoint: `GET /api/health`

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ stdout
- –§–æ—Ä–º–∞—Ç: `üîç Search: "ATMEGA328P-PU"`, `‚úÖ Mouser: 1234 results`, etc.
- –õ–æ–≥–∏ –≤ `/opt/deep-agg/logs/out.log`, `/opt/deep-agg/logs/err.log`

### –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å (TODO)

1. **Request counter** (—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ)
2. **Cache hit rate** (–ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à)
3. **Average response time** (—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞)
4. **Error rate** (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫)
5. **API source usage** (–∫–∞–∫–æ–π API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∞—â–µ)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```javascript
const metrics = {
  requests: 0,
  cacheHits: 0,
  cacheMisses: 0,
  errors: 0,
  responseTimes: [],
  apiUsage: { mouser: 0, tme: 0, farnell: 0, digikey: 0 }
};

app.get('/api/metrics', (req, res) => {
  const avgResponseTime = metrics.responseTimes.reduce((a, b) => a + b, 0) / metrics.responseTimes.length;
  const cacheHitRate = (metrics.cacheHits / (metrics.cacheHits + metrics.cacheMisses)) * 100;
  
  res.json({
    requests: metrics.requests,
    cacheHitRate: cacheHitRate.toFixed(2) + '%',
    avgResponseTime: avgResponseTime.toFixed(0) + 'ms',
    errors: metrics.errors,
    apiUsage: metrics.apiUsage
  });
});
```

---

## üîß TROUBLESHOOTING

### –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å:**
   ```bash
   ssh root@5.129.228.88
   ps aux | grep node
   ```

2. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:**
   ```bash
   tail -f /opt/deep-agg/logs/err.log
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:**
   ```bash
   cd /opt/deep-agg
   pkill -f 'node.*server.js'
   nohup node server.js > logs/out.log 2> logs/err.log &
   ```

### API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check:**
   ```bash
   curl http://127.0.0.1:9201/api/health
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   cat /opt/deep-agg/.env
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å WARP proxy:**
   ```bash
   warp-cli status
   curl -x http://127.0.0.1:25345 https://api.ipify.org
   ```

### –ö—ç—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î:**
   ```bash
   ls -lh /opt/deep-agg/cache.json
   sqlite3 /opt/deep-agg/cache.json "SELECT COUNT(*) FROM products;"
   ```

2. **–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à:**
   ```bash
   rm /opt/deep-agg/cache.json
   # –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
   ```

### Frontend –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:**
   ```bash
   ls -la /opt/deep-agg/public/
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å CORS headers:**
   ```bash
   curl -I http://5.129.228.88:9201/
   ```

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**Deep Aggregator v3.0** ‚Äî —ç—Ç–æ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö, –∫–æ—Ç–æ—Ä–∞—è —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç 4 –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –º–∏—Ä–æ–≤—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —á–µ—Ä–µ–∑ –∏—Ö –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ API.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –í—Å–µ API —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –∏ —Å–ª–∏–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API
- ‚úÖ Proxy –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º API
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ç—ë–º–Ω–æ–π —Ç–µ–º–æ–π
- ‚úÖ Deployment –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω

**–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏:**
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ TME API (response structure)
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–æ—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ TME (exact match)
3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ Farnell API (response wrapper)
4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ proxy –¥–ª—è TME –∏ Farnell
5. –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—ë–Ω web scraping (strict requirement)

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DigiKey OAuth (token caching)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd service
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 29.01.2025  
**–ê–≤—Ç–æ—Ä:** GitHub Copilot + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–í–µ—Ä—Å–∏—è:** 1.0

