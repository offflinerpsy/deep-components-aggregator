# AdminJS Integration Guide

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** (450 –ø–∞–∫–µ—Ç–æ–≤):
   - adminjs@^7.8.1
   - @adminjs/express@^6.1.0
   - @adminjs/sequelize@^4.1.0
   - sequelize@^6.35.0
   - sqlite3@^5.1.6
   - bcrypt@^5.1.1
   - express-session@^1.17.3

2. **–°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã**:
   - `src/db/sequelize.js` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite
   - `src/db/models.js` - 7 –º–æ–¥–µ–ª–µ–π (AdminUser, Order, ApiHealth, ApiKey, StaticPage, ManualProduct, ProjectStat)
   - `src/db/init.js` - —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
   - `src/admin/index.js` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AdminJS
   - `src/admin/components/Dashboard.jsx` - –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–∞—à–±–æ—Ä–¥
   - `src/admin/components/OrderItemsShow.jsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –¥–∏–ª–ª–µ—Ä–æ–≤

## üöÄ –®–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd /opt/deep-agg
node src/db/init.js
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –°–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ SQLite (var/db/deepagg.sqlite)
- –°–æ–∑–¥–∞—Å—Ç –∞–¥–º–∏–Ω-—é–∑–µ—Ä–∞: `admin@deepagg.local` / `admin123`
- –î–æ–±–∞–≤–∏—Ç –∑–∞–ø–∏—Å–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ API (DigiKey, Mouser, Farnell, TME)
- –°–æ–∑–¥–∞—Å—Ç —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–û –∫–æ–º–ø–∞–Ω–∏–∏, –ö–æ–Ω—Ç–∞–∫—Ç—ã, –î–æ—Å—Ç–∞–≤–∫–∞, –ü–æ–ª–∏—Ç–∏–∫–∞)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —Å–µ–≥–æ–¥–Ω—è

### –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ server.js

–î–æ–±–∞–≤—å—Ç–µ –≤ `server.js` –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–æ–≤:

```javascript
// AdminJS
const { adminRouter } = require('./src/admin/index')
const { sequelize } = require('./src/db/models')

// ... existing code ...

// –ü–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–æ—É—Ç–æ–≤, –ø–µ—Ä–µ–¥ app.listen():

// Mount AdminJS
app.use('/admin', adminRouter)

// Sync database before starting server
sequelize.sync({ alter: true }).then(() => {
  console.log('‚úÖ Database synced')
  
  // existing app.listen() code here
})
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å .env (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` –¥–ª—è production:

```env
# Admin Panel
ADMIN_SESSION_SECRET=your-random-secret-here-change-in-production
ADMIN_COOKIE_SECRET=another-random-secret-change-in-production
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
pm2 restart deepagg-backend
# –∏–ª–∏
npm run dev
```

### –®–∞–≥ 5: –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:
- **URL**: http://localhost:9201/admin
- **Email**: admin@deepagg.local
- **Password**: admin123

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–¥–º–∏–Ω–∫–∏

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

### Dashboard (–≥–ª–∞–≤–Ω–∞—è)
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è (–ø–æ–∏—Å–∫–∏, –∫—ç—à, –∑–∞–∫–∞–∑—ã)
- üîå –°—Ç–∞—Ç—É—Å API (DigiKey, Mouser, Farnell, TME)
- ‚è±Ô∏è –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- üìà Success Rate –∑–∞ 24 —á–∞—Å–∞

### –ú–µ–Ω—é "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
- **–ó–∞–∫–∞–∑—ã (Orders)**: –ü—Ä–æ—Å–º–æ—Ç—Ä/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
  - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ
  - –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –¥–∏–ª–ª–µ—Ä–æ–≤ (DigiKey/Mouser/Farnell/TME)
  - –°—Ç–∞—Ç—É—Å—ã: –ù–æ–≤—ã–π ‚Üí –í –æ–±—Ä–∞–±–æ—Ç–∫–µ ‚Üí –û—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚Üí –î–æ—Å—Ç–∞–≤–ª–µ–Ω
  - –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –ú–µ–Ω—é "–¢–æ–≤–∞—Ä—ã"
- **–†—É—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (ManualProduct)**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤—Ä—É—á–Ω—É—é
  - MPN, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å, –æ–ø–∏—Å–∞–Ω–∏–µ
  - –¶–µ–Ω–∞, –≤–∞–ª—é—Ç–∞, —Ä–µ–≥–∏–æ–Ω, —Å–∫–ª–∞–¥
  - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –¥–∞—Ç–∞—à–∏—Ç
  - –ö–∞—Ç–µ–≥–æ—Ä–∏—è

### –ú–µ–Ω—é "–ö–æ–Ω—Ç–µ–Ω—Ç"
- **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (StaticPage)**: CMS –¥–ª—è footer/header
  - Slug (URL)
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫, –∫–æ–Ω—Ç–µ–Ω—Ç (HTML/Markdown)
  - Meta –æ–ø–∏—Å–∞–Ω–∏–µ
  - –ü–æ–∑–∏—Ü–∏—è (—à–∞–ø–∫–∞/–ø–æ–¥–≤–∞–ª/–æ–±–∞)
  - –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  - –ü—É–±–ª–∏–∫–∞—Ü–∏—è

### –ú–µ–Ω—é "–°–∏—Å—Ç–µ–º–∞"
- **API Health**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ API
  - –°—Ç–∞—Ç—É—Å: Online/Offline/Degraded
  - –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (ms)
  - Success rate –∑–∞ 24—á

- **API Keys**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏
  - –°–µ—Ä–≤–∏—Å (DigiKey/Mouser/Farnell/TME/OEMstrade)
  - –ò–º—è –∫–ª—é—á–∞ (CLIENT_ID, API_KEY, etc.)
  - –ó–Ω–∞—á–µ–Ω–∏–µ (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ)
  - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è

- **Admin Users**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∞–¥–º–∏–Ω–∫–∏
  - Email, –∏–º—è, —Ä–æ–ª—å (–∞–¥–º–∏–Ω/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä)
  - –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
  - –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è

### –ú–µ–Ω—é "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
- **ProjectStat**: –ò—Å—Ç–æ—Ä–∏—è –º–µ—Ç—Ä–∏–∫ –ø–æ –¥–Ω—è–º
  - –î–∞—Ç–∞
  - –í—Å–µ–≥–æ –ø–æ–∏—Å–∫–æ–≤
  - –ü–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à
  - Live-–ø–æ–∏—Å–∫ (API)
  - –ó–∞–∫–∞–∑—ã
  - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: bcrypt-—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
2. **–°–µ—Å—Å–∏–∏**: express-session —Å httpOnly cookies
3. **CSRF**: –∑–∞—â–∏—Ç–∞ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ AdminJS
4. **–†–æ–ª–∏**: admin (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø), moderator (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π)

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
–í `src/admin/index.js`:

```javascript
branding: {
  companyName: '–í–∞—à–µ –Ω–∞–∑–≤–∞–Ω–∏–µ',
  theme: {
    colors: {
      primary100: '#1976d2' // –í–∞—à —Ü–≤–µ—Ç
    }
  }
}
```

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å
1. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å –≤ `src/db/models.js`
2. –î–æ–±–∞–≤—å—Ç–µ –≤ `resources` –≤ `src/admin/index.js`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `node src/db/init.js` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã

## üîó API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

–î–æ–±–∞–≤—å—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ `server.js`:

```javascript
// Static pages API for frontend
app.get('/api/static-pages', async (req, res) => {
  try {
    const { StaticPage } = require('./src/db/models')
    const pages = await StaticPage.findAll({
      where: { is_published: true },
      order: [['sort_order', 'ASC']],
      attributes: ['slug', 'title', 'position']
    })
    res.json(pages)
  } catch (error) {
    res.status(500).json({ error: 'Failed to fetch pages' })
  }
})
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Next.js footer/header

–í `v0-components-aggregator-page/app/layout.tsx`:

```typescript
// Fetch static pages
const staticPages = await fetch('http://localhost:9201/api/static-pages').then(r => r.json())

// Filter by position
const footerLinks = staticPages.filter(p => ['footer', 'both'].includes(p.position))
const headerLinks = staticPages.filter(p => ['header', 'both'].includes(p.position))

// Render in footer/header
{footerLinks.map(link => (
  <a key={link.slug} href={`/pages/${link.slug}`}>{link.title}</a>
))}
```

## üìù TODO –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ /admin
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å API keys (DigiKey, Mouser, Farnell, TME)
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ä—É—á–Ω–æ–π —Ç–æ–≤–∞—Ä
6. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API (cron/scheduler)
7. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
8. ‚è≥ –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
9. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö (email/Telegram)

## ‚ùì Troubleshooting

### –û—à–∏–±–∫–∞ "Cannot find module '@adminjs/design-system'"
```bash
npm install @adminjs/design-system
```

### –û—à–∏–±–∫–∞ "Module not found: Can't resolve './components/Dashboard'"
AdminJS –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç JSX-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `AdminJS.bundle()`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ `src/admin/index.js`.

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É `var/db/`:
```bash
mkdir -p /opt/deep-agg/var/db
chmod 755 /opt/deep-agg/var/db
```

### –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–¥–º–∏–Ω-—é–∑–µ—Ä —Å–æ–∑–¥–∞–Ω:
```bash
node -e "const {AdminUser} = require('./src/db/models'); AdminUser.findAll().then(console.log)"
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

‚úÖ –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞ –Ω–∞ `/admin`  
‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ 4 –¥–∏–ª–ª–µ—Ä–∞  
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ API  
‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–ª—é—á–µ–π –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É  
‚úÖ CMS –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (footer/header)  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤—Ä—É—á–Ω—É—é  
‚úÖ –í–ø–µ—á–∞—Ç–ª—è—é—â–∏–π –¥–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞  
‚úÖ –ó–∞—â–∏—â—ë–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (bcrypt + sessions)  

**–î–æ—Å—Ç—É–ø**: http://localhost:9201/admin  
**–õ–æ–≥–∏–Ω**: admin@deepagg.local  
**–ü–∞—Ä–æ–ª—å**: admin123 (—Å–º–µ–Ω–∏—Ç–µ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞!)
