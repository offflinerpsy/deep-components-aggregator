# üîê –î–û–°–¢–£–ü–´ –ê–î–ú–ò–ù–ö–ò –ò –ò–ó–ú–ï–ù–ï–ù–ò–Ø

**–î–∞—Ç–∞**: 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞)

---

## üéØ –î–û–°–¢–£–ü–´ –í –ê–î–ú–ò–ù–ö–£

### –õ–æ–≥–∏–Ω –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:

```
URL:      https://prosnab.tech/admin
Email:    admin@prosnab.tech
–ü–∞—Ä–æ–ª—å:   admin123
```

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –°–º–µ–Ω–∏ –µ–≥–æ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞!

---

## üîß –ß–¢–û –ò–ó–ú–ï–ù–ï–ù–û

### 1. –°–±—Ä–æ—à–µ–Ω –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞

**–§–∞–π–ª**: `/opt/deep-agg/scripts/reset-admin-password.mjs` (—Å–æ–∑–¥–∞–Ω)

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**:
- –ü–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ `admin123` —á–µ—Ä–µ–∑ bcrypt
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `admin@prosnab.tech`

**–û—Ç–∫–∞—Ç**:
```bash
# –£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
rm /opt/deep-agg/scripts/reset-admin-password.mjs

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
node scripts/create-admin-user.mjs \
  --email admin@prosnab.tech \
  --name "–°—É–ø–µ—Ä –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" \
  --password "–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å"
```

---

### 2. –û—Ç–∫–ª—é—á–µ–Ω–∞ email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–§–∞–π–ª**: `/opt/deep-agg/api/auth.js`

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ**:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å `email_verified = 1` (—Å—Ä–∞–∑—É –∞–∫—Ç–∏–≤–Ω—ã)
- ‚úÖ –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- ‚úÖ –ú–æ–∂–Ω–æ –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –£–±—Ä–∞–Ω–∞ –≤—Å—è –ª–æ–≥–∏–∫–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω**: `/opt/deep-agg/api/auth.js.backup-before-disable-email-verification`

**–û—Ç–∫–∞—Ç (–≤–∞—Ä–∏–∞–Ω—Ç 1 - —á–µ—Ä–µ–∑ Git)**:
```bash
cd /opt/deep-agg
git revert HEAD  # –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç
pm2 restart all
```

**–û—Ç–∫–∞—Ç (–≤–∞—Ä–∏–∞–Ω—Ç 2 - —á–µ—Ä–µ–∑ –±—ç–∫–∞–ø)**:
```bash
cd /opt/deep-agg
cp api/auth.js.backup-before-disable-email-verification api/auth.js
pm2 restart all
```

---

## üìã –ü–û–í–ï–î–ï–ù–ò–ï –ü–û–°–õ–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (POST /auth/register):

**–î–æ**:
```json
{
  "ok": true,
  "message": "Registration accepted. Please check your email to verify your account."
}
```
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–≥ –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è
- –ù—É–∂–Ω–æ –±—ã–ª–æ –∫–ª–∏–∫–∞—Ç—å —Å—Å—ã–ª–∫—É –≤ –ø–∏—Å—å–º–µ

**–ü–æ—Å–ª–µ**:
```json
{
  "ok": true,
  "message": "Registration successful. You can now login."
}
```
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è **—Å—Ä–∞–∑—É**
- –ü–∏—Å—å–º–∞ **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è**

---

### –õ–æ–≥–∏–Ω (POST /auth/login):

**–ù–µ –∏–∑–º–µ–Ω–µ–Ω–æ** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ `email_verified` –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤ passport strategy.

–†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ:
- ‚úÖ Email + –ø–∞—Ä–æ–ª—å
- ‚úÖ OAuth (Google, Yandex, VK)

---

## üß™ –ü–†–û–í–ï–†–ö–ê

### 1. –ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø –≤ –∞–¥–º–∏–Ω–∫—É:

```bash
curl -c cookies.txt https://prosnab.tech/admin -L -w "%{http_code}\n"
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 200 (—Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞)
```

–ò–ª–∏ –æ—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ: https://prosnab.tech/admin

**–õ–æ–≥–∏–Ω**: `admin@prosnab.tech`  
**–ü–∞—Ä–æ–ª—å**: `admin123`

---

### 2. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
curl -X POST https://prosnab.tech/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "test123456",
    "confirmPassword": "test123456",
    "name": "Test User"
  }' | jq
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è**:
```json
{
  "ok": true,
  "userId": "...",
  "message": "Registration successful. You can now login."
}
```

---

### 3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏–Ω –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```bash
curl -X POST https://prosnab.tech/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "test123456"
  }' -c cookies.txt | jq
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è**:
```json
{
  "ok": true,
  "user": {
    "id": "...",
    "email": "test@example.com",
    "name": "Test User"
  }
}
```

---

## üîÑ –ö–ê–ö –û–¢–ö–ê–¢–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ Git:

```bash
cd /opt/deep-agg

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
git log --oneline -5

# –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–º–º–∏—Ç "–í–†–ï–ú–ï–ù–ù–û: –æ—Ç–∫–ª—é—á–µ–Ω–∞ email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è"
git revert <commit_hash>

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
pm2 restart all

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
curl https://prosnab.tech/api/health
```

---

### –ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞—Ç (–µ—Å–ª–∏ Git –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç):

```bash
cd /opt/deep-agg

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å auth.js –∏–∑ –±—ç–∫–∞–ø–∞
cp api/auth.js.backup-before-disable-email-verification api/auth.js

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 restart all

# –£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
rm scripts/reset-admin-password.mjs

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞ –Ω–∞ —Å–ª–æ–∂–Ω—ã–π
node scripts/create-admin-user.mjs \
  --email admin@prosnab.tech \
  --password "–Ω–æ–≤—ã–π_—Å–ª–æ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å_123!" \
  --force
```

---

## üìä –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –§–ê–ô–õ–ê–•

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `scripts/reset-admin-password.mjs` | ‚úÖ –°–æ–∑–¥–∞–Ω | –°–∫—Ä–∏–ø—Ç —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∞ |
| `api/auth.js` | ‚úèÔ∏è –ò–∑–º–µ–Ω—ë–Ω | –û—Ç–∫–ª—é—á–µ–Ω–∞ email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è |
| `api/auth.js.backup-before-disable-email-verification` | üíæ –ë—ç–∫–∞–ø | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π |

---

## ‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

1. **–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞ –ø—Ä–æ—Å—Ç–æ–π** (`admin123`) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!
2. **Email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞** ‚Äî –ª—é–±–æ–π –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø
3. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –Ω–∞ production** –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- ‚úÖ –°–º–µ–Ω–∏ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
- ‚úÖ –í–∫–ª—é—á–∏ email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –æ–±—Ä–∞—Ç–Ω–æ –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–æ–∏—à—å SMTP
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üìù GIT –ö–û–ú–ú–ò–¢

```bash
# –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add api/auth.js scripts/reset-admin-password.mjs
git commit -m "temp: disable email verification for testing

TEMPORARY CHANGES (easy rollback):
- Admin password reset to admin123 (script: scripts/reset-admin-password.mjs)
- Email verification disabled in registration
- Users can login immediately after registration
- Backup created: api/auth.js.backup-before-disable-email-verification

ROLLBACK:
git revert HEAD
pm2 restart all

DO NOT USE IN PRODUCTION!"
```

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–û—Ç–∫–∞—Ç**: –í—Å–µ–≥–¥–∞ –≤–æ–∑–º–æ–∂–µ–Ω —á–µ—Ä–µ–∑ `git revert` –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

---

**–°–æ–∑–¥–∞–Ω–æ**: 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä**: GitHub Copilot
