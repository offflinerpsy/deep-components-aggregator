# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã ‚Äî 17 –æ–∫—Ç—è–±—Ä—è 2025

## ‚úÖ –†–∞–∑–≤–µ–¥–∫–∞ (R) ‚Äî –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### PM2 –ü—Ä–æ—Ü–µ—Å—Å—ã
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id ‚îÇ name               ‚îÇ mode     ‚îÇ ‚Ü∫    ‚îÇ status    ‚îÇ cpu      ‚îÇ memory   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 2  ‚îÇ deep-agg           ‚îÇ fork     ‚îÇ 1793 ‚îÇ online    ‚îÇ 0%       ‚îÇ 189.4mb  ‚îÇ
‚îÇ 6  ‚îÇ deep-v0            ‚îÇ fork     ‚îÇ 16   ‚îÇ online    ‚îÇ 0%       ‚îÇ 126.4mb  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ä—Ç—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã

- **Backend (deep-agg)**: `127.0.0.1:9201` ‚úÖ **OK** (–∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã)
- **Frontend (deep-v0)**: `127.0.0.1:3001` ‚ö†Ô∏è **–û–®–ò–ë–ö–ê** (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 3000)

### API Health Check

```bash
curl http://127.0.0.1:9201/api/health
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "status": "ok",
  "version": "3.2"
}
```

‚úÖ Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### Frontend Check

```bash
curl -I http://127.0.0.1:3001/
```

**HTTP –∫–æ–¥**: `200` ‚úÖ

### Next.js Rewrites

–§–∞–π–ª: `/opt/deep-agg/v0-components-aggregator-page/next.config.mjs`

```javascript
async rewrites() {
  return {
    beforeFiles: [
      {
        source: '/api/:path*',
        destination: 'http://127.0.0.1:9201/api/:path*',
      },
      {
        source: '/auth/:path*',
        destination: 'http://127.0.0.1:9201/auth/:path*',
      },
    ],
  }
}
```

‚úÖ Rewrites –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –ø–æ—Ä—Ç **9201**.

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã** (–∏–∑ –≥–∞–π–¥–æ–≤ –∏ API-CONTRACT.md):

> **R2 Final ‚Äî –ü–æ—Ä—Ç—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã (Source of Truth)**
> - Backend (Express): 127.0.0.1:9201 ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ —Ç–æ—Ä—á–∏—Ç –Ω–∞—Ä—É–∂—É).
> - **Frontend (Next.js/v0): 127.0.0.1:3000** ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç. –õ—é–±—ã–µ dev-–ø–æ–¥–Ω—è—Ç–∏—è –Ω–∞ 3001 ‚Äî –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
```bash
pm2 show deep-v0 | grep 'script args'
# OUTPUT: node_modules/next/dist/bin/next start -p 3001
```

‚ùå –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É **3001**, –∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ **3000**.

### –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (I)

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å `deep-v0`
2. –û–±–Ω–æ–≤–∏—Ç—å ecosystem.config –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—Ä–æ–Ω—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3000
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

---

## üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ –≥–∞–π–¥–∞–º

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∏–∑ ARCHITECTURE.md)

```
NGINX ‚Üí Frontend (port 3001) ‚Üí rewrites ‚Üí Backend (port 9201) ‚Üí External APIs
```

‚ö†Ô∏è –í –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —É–∫–∞–∑–∞–Ω –ø–æ—Ä—Ç 3001, –Ω–æ –≤ API-CONTRACT.md (R2 Final) –≥–æ–≤–æ—Ä–∏—Ç—Å—è:

> Frontend (Next.js/v0): 127.0.0.1:3000 ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç. –õ—é–±—ã–µ dev-–ø–æ–¥–Ω—è—Ç–∏—è –Ω–∞ 3001 ‚Äî –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

**–ö–æ–Ω—Ñ–ª–∏–∫—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: ARCHITECTURE.md vs API-CONTRACT.md

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (–∏–∑ –ü–û–õ–ù–´–ô-–ì–ê–ô–î-–ü–û-–ü–†–û–ï–ö–¢–£.md)

1. **–ñ–∏–≤–æ–π –ø–æ–∏—Å–∫** ‚Äî SSE —á–µ—Ä–µ–∑ `/api/live?q=...`
2. **–ö—ç—à-—Å–ª–æ–π** ‚Äî SQLite (`/opt/deep-agg/var/db/deepagg.sqlite`)
3. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è RU‚ÜíEN** ‚Äî backend –æ–±—è–∑–∞–Ω —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
4. **Rewrites** ‚Äî —Ñ—Ä–æ–Ω—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ 9201, —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `/api/*`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

**Backend**:
- Express server: `server.js`
- API routes: `api/*.mjs`, `src/api/*.mjs`
- Parsers: DigiKey, Mouser, TME, Farnell
- Proxy: Undici ProxyAgent ‚Üí WARP (127.0.0.1:40000)

**Frontend**:
- Next.js 14 App Router
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: `ResultsClient.tsx`, `ProductClient.tsx`
- Routes: `/`, `/results`, `/product/[mpn]`

**–ê–¥–º–∏–Ω–∫–∞**:
- URL: `https://prosnab.tech/admin`
- Login: `admin@prosnab.tech` / `password`
- AdminJS integration

---

## üîç –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

### Data Flow: –ü–æ–∏—Å–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –≤–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å "—Ä–µ–∑–∏—Å—Ç–æ—Ä" ‚Üí `/results?q=—Ä–µ–∑–∏—Å—Ç–æ—Ä`
2. **Next.js SSR** –¥–µ–ª–∞–µ—Ç rewrite ‚Üí `http://localhost:9201/api/cache?q=—Ä–µ–∑–∏—Å—Ç–æ—Ä`
3. **Backend** –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç ‚Üí "—Ä–µ–∑–∏—Å—Ç–æ—Ä" ‚Üí "resistor" (queryNorm)
4. **SQLite lookup** ‚Üí –µ—Å–ª–∏ –µ—Å—Ç—å –∫—ç—à (< 7 –¥–Ω–µ–π) ‚Üí –≤–æ–∑–≤—Ä–∞—Ç
5. –ï—Å–ª–∏ –∫—ç—à–∞ –Ω–µ—Ç ‚Üí **Live –ø–æ–∏—Å–∫** —á–µ—Ä–µ–∑ SSE `/api/live?q=resistor`
6. **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã** (DigiKey, Mouser, TME, Farnell) ‚Üí —á–µ—Ä–µ–∑ Undici ProxyAgent (WARP)
7. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã** ‚Üí –∫—ç—à –≤ SQLite + –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ SSE stream
8. **Frontend** (EventSource) ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- **–ö—ç—à-–ø–µ—Ä–≤—ã–π**: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ SQLite
- **–ñ–∏–≤–æ–π –ø–æ–∏—Å–∫**: SSE –¥–ª—è realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: RU‚ÜíEN –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —É –∞–Ω–≥–ª–æ—è–∑—ã—á–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
- **–ü—Ä–æ–∫—Å–∏**: WARP (port 40000) –¥–ª—è –æ–±—Ö–æ–¥–∞ –≥–µ–æ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- **Privacy**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏–æ–Ω/—Ü–µ–Ω—É/–Ω–∞–ª–∏—á–∏–µ; —Å—Å—ã–ª–∫–∏ –¥–∏–ª–µ—Ä–æ–≤ ‚Äî –≤ –∞–¥–º–∏–Ω–∫–µ

### SSE –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

**–§–æ—Ä–º–∞—Ç** (WHATWG):
```http
Content-Type: text/event-stream; charset=utf-8
Cache-Control: no-cache
Connection: keep-alive
X-Accel-Buffering: no

: ping

data: {"mpn":"ABC123","manufacturer":"Vishay"}

: ping
```

**–í–∞–∂–Ω–æ**:
- –°–æ–±—ã—Ç–∏—è —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è **–¥–≤–æ–π–Ω—ã–º \n** (`\n\n`)
- Heartbeat –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ `: ping\n\n` –∫–∞–∂–¥—ã–µ 15s
- `X-Accel-Buffering: no` –Ω–∞ nginx (–∏–Ω–∞—á–µ –±—É—Ñ–µ—Ä–∏—Ç—Å—è)

---

## üìù –í—ã–≤–æ–¥

–°–∏—Å—Ç–µ–º–∞ **—Ä–∞–±–æ—Ç–∞–µ—Ç**, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å **3001** –Ω–∞ **3000** —Å–æ–≥–ª–∞—Å–Ω–æ Source of Truth –∏–∑ API-CONTRACT.md (R2 Final).

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2 –¥–ª—è deep-v0 –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ø–æ—Ä—Ç—É 3000.

---

**–°–æ–∑–¥–∞–Ω–æ**: 2025-10-17  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Backend —Ä–∞–±–æ—Ç–∞–µ—Ç | ‚ö†Ô∏è Frontend –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—Ç—É
