# –û—Ç—á—ë—Ç: –ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–∏–¥–∏–º–æ—Å—Ç—å—é PageLoader

**–î–∞—Ç–∞**: 6 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ç–∫–∞**: `feat/r4-online-autocomplete`  
**–ü—Ä–æ–±–ª–µ–º–∞**: Loader –Ω–µ –≤–∏–¥–µ–Ω –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

## üîç –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç: **"—Å–∫–∞—á–∫–∞ –Ω–µ—Ç, –Ω–æ –∏ –ª–æ–∞–¥–µ—Ä–∞ —Ç–æ–∂–µ"**

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è PageLoader (–±–µ–ª—ã–π overlay —Å blur-—ç—Ñ—Ñ–µ–∫—Ç–æ–º –∏ 6 –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏) loader –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ `/results`.

---

## üìã –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç PageLoader

**–§–∞–π–ª**: `components/PageLoader.tsx`

```tsx
'use client'

export default function PageLoader() {
  return (
    <div className="page-loader-overlay">
      <div className="page-loader-wrapper">
        <div className="page-loader-box-wrap">
          <div className="page-loader-box one"></div>
          <div className="page-loader-box two"></div>
          <div className="page-loader-box three"></div>
          <div className="page-loader-box four"></div>
          <div className="page-loader-box five"></div>
          <div className="page-loader-box six"></div>
        </div>
      </div>
    </div>
  )
}
```

### 2. CSS —Å—Ç–∏–ª–∏

**–§–∞–π–ª**: `app/globals.css` (—Å—Ç—Ä–æ–∫–∏ ~1450-1700)

```css
.page-loader-overlay {
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  animation: fadeIn 0.3s ease-in;
}

.page-loader-wrapper {
  position: relative;
  width: 200px;
  height: 200px;
  background-color: transparent;
}

.page-loader-box-wrap {
  width: 70%;
  height: 70%;
  margin: calc((100% - 70%)/2);
  position: relative;
  transform: rotate(-45deg);
}

.page-loader-box {
  width: 100%;
  height: 100%;
  position: absolute;
  left: 0;
  top: 0;
  background: linear-gradient(to right, #141562, #486FBC, #EAB5A1, #8DD6FF, #4973C9, #D07CA7, #F4915E, #F5919E, #B46F89, #141562, #486FBC);
  background-position: 0% 50%;
  background-size: 1000% 1000%;
  visibility: hidden;
}

.page-loader-box.one {
  animation: moveGradient 15s infinite, oneMove 3.5s infinite;
}

/* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ .two, .three, .four, .five, .six ... */
```

**–ê–Ω–∏–º–∞—Ü–∏–∏**: 6 keyframes (`oneMove` ... `sixMove`) —Å–æ–∑–¥–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç –≤—Ä–∞—â–∞—é—â–∏—Ö—Å—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤

### 3. –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PageLoader

#### A. Next.js Suspense Boundary
**–§–∞–π–ª**: `app/loading.tsx`
```tsx
import PageLoader from "@/components/PageLoader"

export default function Loading() {
  return <PageLoader />
}
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ä–æ—É—Ç–∞–º–∏ (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏)

#### B. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–ø–µ—Ä–µ–¥ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π)
**–§–∞–π–ª**: `app/page.tsx`

```tsx
const [isNavigating, setIsNavigating] = useState(false)

// –í AutocompleteSearch:
onSearch={(q) => {
  setIsNavigating(true)
  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã loader —É—Å–ø–µ–ª –ø–æ–∫–∞–∑–∞—Ç—å—Å—è
  setTimeout(() => {
    window.location.href = `/results?q=${encodeURIComponent(q)}`
  }, 100)
}}

// –í —Ä–µ–Ω–¥–µ—Ä–µ:
{isNavigating && <PageLoader />}
```

**–õ–æ–≥–∏–∫–∞**: 
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å
2. `setIsNavigating(true)` ‚Üí PageLoader –ø–æ—è–≤–ª—è–µ—Ç—Å—è
3. –ó–∞–¥–µ—Ä–∂–∫–∞ 100ms
4. `window.location.href` ‚Üí –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

#### C. –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏)
**–§–∞–π–ª**: `components/ResultsClient.tsx`

```tsx
const [isLoading, setIsLoading] = useState(true)

// –ü–µ—Ä–≤—ã–π useEffect - —Ç–∞–π–º–µ—Ä 500ms
useEffect(() => {
  const timer = setTimeout(() => setIsLoading(false), 500)
  return () => clearTimeout(timer)
}, [])

// –í—Ç–æ—Ä–æ–π useEffect - SSE live search
useEffect(() => {
  if (mode !== 'live' || !q) return
  setIsLoading(true)  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º loader –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ SSE
  const es = new EventSource(`/api/live/search?q=${encodeURIComponent(q)}`)
  
  es.addEventListener('done', () => { 
    es.close()
    setProgress('–ì–æ—Ç–æ–≤–æ')
    setIsLoading(false)  // –°–∫—Ä—ã–≤–∞–µ–º loader –∫–æ–≥–¥–∞ –ø–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à—ë–Ω
  })
  
  es.onerror = () => { 
    es.close()
    setProgress('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è')
    setIsLoading(false)  // –°–∫—Ä—ã–≤–∞–µ–º loader –ø—Ä–∏ –æ—à–∏–±–∫–µ
  }
}, [mode, q])

// –í —Ä–µ–Ω–¥–µ—Ä–µ:
{isLoading && <PageLoader />}
<div style={{ opacity: isLoading ? 0.3 : 1, transition: 'opacity 0.5s' }}>
  {/* –ö–æ–Ω—Ç–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */}
</div>
```

---

## üêõ –ü–æ—á–µ–º—É loader –Ω–µ –≤–∏–¥–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞ #1: SSR –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

**–ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–≤–æ–¥–∏—Ç "test"
2. setIsNavigating(true) ‚Üí PageLoader –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
3. setTimeout 100ms
4. window.location.href = '/results?q=test'
5. ‚ùå –ë–†–ê–£–ó–ï–† –ù–ê–ß–ò–ù–ê–ï–¢ –ü–û–õ–ù–£–Æ –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–£ –°–¢–†–ê–ù–ò–¶–´
6. Next.js SSR –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
7. app/results/page.tsx ‚Üí fetchCacheSSR(q)
8. –ó–∞–ø—Ä–æ—Å –∫ /api/vitrine/list?q=test
9. ‚úÖ –î–ê–ù–ù–´–ï –ò–ó –ö–≠–®–ê –í–û–ó–í–†–ê–©–ê–Æ–¢–°–Ø –ú–ì–ù–û–í–ï–ù–ù–û
10. SSR —Ä–µ–Ω–¥–µ—Ä–∏—Ç –ø–æ–ª–Ω—ã–π HTML —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
11. –ë—Ä–∞—É–∑–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π HTML
12. React –≥–∏–¥—Ä–∞—Ç–∏—Ä—É–µ—Ç—Å—è
13. useEffect —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç isLoading=true –Ω–∞ 500ms
14. ‚ùå –ù–û –ö–û–ù–¢–ï–ù–¢ –£–ñ–ï –í–ò–î–ï–ù, loader –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ü–û–í–ï–†–• –≥–æ—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl**:
```bash
curl -s 'http://localhost:3000/results?q=test' | grep "page-loader-overlay"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: NO MATCHES
```
‚Üí **SSR HTML –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç loader**, —Ç–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –ó–∞–¥–µ—Ä–∂–∫–∞ 100ms —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è

–ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:
```tsx
setTimeout(() => {
  window.location.href = `/results?q=${encodeURIComponent(q)}`
}, 100)
```

**100 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥** –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è:
- –û—Ç—Ä–∏—Å–æ–≤–∫–∏ DOM (.page-loader-overlay)
- –ó–∞–ø—É—Å–∫–∞ CSS –∞–Ω–∏–º–∞—Ü–∏–∏ fadeIn (300ms)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤ (3.5s —Ü–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏)

**–ë—Ä–∞—É–∑–µ—Ä —É—Å–ø–µ–≤–∞–µ—Ç**:
- –ù–∞—á–∞—Ç—å —Ä–µ–Ω–¥–µ—Ä loader ‚Üí –ü—Ä–µ—Ä–≤–∞—Ç—å —Ä–µ–Ω–¥–µ—Ä ‚Üí –ù–∞—á–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

### –ü—Ä–æ–±–ª–µ–º–∞ #3: window.location.href —É–±–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ

`window.location.href` –≤—ã–∑—ã–≤–∞–µ—Ç **–ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã**:
- –¢–µ–∫—É—â–∞—è React-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è
- Loader –∏—Å—á–µ–∑–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å –Ω–µ–π
- –ë—Ä–∞—É–∑–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–π HTML
- React –∑–∞–Ω–æ–≤–æ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

**app/loading.tsx –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- Next.js Suspense —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ **–∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏** (`router.push()`)
- `window.location.href` = **—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è** (–Ω–æ–≤—ã–π HTTP-–∑–∞–ø—Ä–æ—Å)

### –ü—Ä–æ–±–ª–µ–º–∞ #4: isLoading –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ü–û–°–õ–ï –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
```tsx
const [isLoading, setIsLoading] = useState(true)  // ‚Üê –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ true

useEffect(() => {
  const timer = setTimeout(() => setIsLoading(false), 500)
  return () => clearTimeout(timer)
}, [])
```

**–ù–æ**:
1. SSR –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTML —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (–±–µ–∑ loader)
2. –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç **–¥–æ –∑–∞–ø—É—Å–∫–∞ JavaScript**
3. React –≥–∏–¥—Ä–∞—Ç–∏—Ä—É–µ—Ç—Å—è ‚Üí useEffect –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ‚Üí isLoading —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è true
4. Loader –ø–æ—è–≤–ª—è–µ—Ç—Å—è **–ø–æ–≤–µ—Ä—Ö —É–∂–µ –≤–∏–¥–∏–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**
5. –ß–µ—Ä–µ–∑ 500ms loader –∏—Å—á–µ–∑–∞–µ—Ç

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç**:
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí –í–Ω–µ–∑–∞–ø–Ω–æ —Ç—É—Å–∫–Ω–µ—é—Ç (opacity 0.3) ‚Üí Loader –ø–æ—è–≤–ª—è–µ—Ç—Å—è ‚Üí –ò—Å—á–µ–∑–∞–µ—Ç ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —è—Ä–∫–∏–µ

–í–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ:
- Loader ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ ‚Üí –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

## üìä –í–∏–∑—É–∞–ª—å–Ω—ã–π timeline –ø—Ä–æ–±–ª–µ–º—ã

```
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:
‚îÇ
‚îú‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç Enter
‚îú‚îÄ setIsNavigating(true)
‚îú‚îÄ <PageLoader /> –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è
‚îÇ  ‚îî‚îÄ fadeIn –∞–Ω–∏–º–∞—Ü–∏—è 300ms (–Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç)
‚îú‚îÄ ‚è±Ô∏è  100ms –∑–∞–¥–µ—Ä–∂–∫–∞
‚îú‚îÄ window.location.href –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
‚îÇ  ‚îî‚îÄ ‚ùå React unmount, loader –∏—Å—á–µ–∑–∞–µ—Ç
‚îî‚îÄ –ë—Ä–∞—É–∑–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ /results

–°–µ—Ä–≤–µ—Ä:
‚îÇ
‚îú‚îÄ Next.js SSR –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å /results?q=test
‚îú‚îÄ fetchCacheSSR() ‚Üí /api/vitrine/list?q=test
‚îú‚îÄ ‚úÖ –ö—ç—à –æ—Ç–≤–µ—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (< 50ms)
‚îú‚îÄ –†–µ–Ω–¥–µ—Ä HTML —Å –ø–æ–ª–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
‚îî‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ HTML –±—Ä–∞—É–∑–µ—Ä—É

–ë—Ä–∞—É–∑–µ—Ä (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤):
‚îÇ
‚îú‚îÄ –ü–æ–ª—É—á–µ–Ω HTML —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
‚îú‚îÄ üñºÔ∏è  –ö–æ–Ω—Ç–µ–Ω—Ç –í–ò–î–ï–ù —Å—Ä–∞–∑—É (–¥–æ JS)
‚îú‚îÄ React hydration –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
‚îú‚îÄ ResultsClient –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
‚îÇ  ‚îî‚îÄ isLoading = true (–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
‚îú‚îÄ useEffect –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
‚îÇ  ‚îî‚îÄ setTimeout(setIsLoading(false), 500)
‚îú‚îÄ üå´Ô∏è  –ö–æ–Ω—Ç–µ–Ω—Ç —Ç—É—Å–∫–Ω–µ–µ—Ç (opacity 0.3)
‚îú‚îÄ <PageLoader /> –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö
‚îú‚îÄ ‚è±Ô∏è  500ms –∑–∞–¥–µ—Ä–∂–∫–∞
‚îú‚îÄ setIsLoading(false)
‚îú‚îÄ Loader –∏—Å—á–µ–∑–∞–µ—Ç
‚îî‚îÄ –ö–æ–Ω—Ç–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ opacity 1.0

‚ùå LOADER –ü–û–Ø–í–ò–õ–°–Ø –ü–û–°–õ–ï –ö–û–ù–¢–ï–ù–¢–ê, –ù–ï –î–û
```

---

## üîß –ü–æ–ø—ã—Ç–∫–∏ —Ä–µ—à–µ–Ω–∏—è (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã)

### –ü–æ–ø—ã—Ç–∫–∞ #1: –£–±—Ä–∞—Ç—å isMounted (‚úÖ –†–µ—à–µ–Ω–∞ –±–µ–ª–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
**Commit**: `6a0455f`
```tsx
// –ë—ã–ª–æ:
{isMounted && isLoading && <PageLoader />}

// –°—Ç–∞–ª–æ:
{isLoading && <PageLoader />}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–æ–ª—å—à–µ –Ω–µ –±–µ–ª–∞—è, –Ω–æ loader –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–µ–Ω

### –ü–æ–ø—ã—Ç–∫–∞ #2: –ü—Ä–∏–≤—è–∑–∞—Ç—å isLoading –∫ SSE —Å–æ–±—ã—Ç–∏—è–º
**Commit**: —Ç–µ–∫—É—â–∏–π
```tsx
useEffect(() => {
  if (mode !== 'live' || !q) return
  setIsLoading(true)  // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  const es = new EventSource(...)
  es.addEventListener('done', () => { 
    setIsLoading(false)  // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  })
}, [mode, q])
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Loader –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ live-—Ä–µ–∂–∏–º–µ, –Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞

### –ü–æ–ø—ã—Ç–∫–∞ #3: –ö–æ—Ä–æ—Ç–∫–∏–π timeout 500ms
```tsx
useEffect(() => {
  const timer = setTimeout(() => setIsLoading(false), 500)
  return () => clearTimeout(timer)
}, [])
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Loader –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ 500ms –ø–æ–≤–µ—Ä—Ö —É–∂–µ –≤–∏–¥–∏–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### –ü–æ–ø—ã—Ç–∫–∞ #4: –ü–æ–∫–∞–∑–∞—Ç—å loader –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–µ—Ä–µ–¥ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
```tsx
const [isNavigating, setIsNavigating] = useState(false)

onSearch={(q) => {
  setIsNavigating(true)
  setTimeout(() => {
    window.location.href = `/results?q=${encodeURIComponent(q)}`
  }, 100)
}}

{isNavigating && <PageLoader />}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 100ms –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, loader –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å—Å—è

---

## üí° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç A: –£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π

```tsx
onSearch={(q) => {
  setIsNavigating(true)
  setTimeout(() => {
    window.location.href = `/results?q=${encodeURIComponent(q)}`
  }, 500)  // –ë—ã–ª–æ 100ms ‚Üí –°—Ç–∞–ª–æ 500ms
}}
```

**–ü–ª—é—Å—ã**:
- –ü—Ä–æ—Å—Ç–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- Loader –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∏–¥–µ–Ω 500ms

**–ú–∏–Ω—É—Å—ã**:
- –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ UX
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥—ë—Ç –¥–æ–ª—å—à–µ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Next.js router.push() –≤–º–µ—Å—Ç–æ window.location.href

```tsx
'use client'
import { useRouter } from 'next/navigation'

const router = useRouter()

onSearch={(q) => {
  setIsNavigating(true)
  router.push(`/results?q=${encodeURIComponent(q)}`)
}}
```

**–ü–ª—é—Å—ã**:
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- app/loading.tsx –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

**–ú–∏–Ω—É—Å—ã**:
- –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –ú–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å SSR –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –í–∞—Ä–∏–∞–Ω—Ç C: –ü–æ–∫–∞–∑–∞—Ç—å loader –≤ SSR HTML

–î–æ–±–∞–≤–∏—Ç—å –≤ `app/results/page.tsx`:
```tsx
export default async function ResultsPage({ searchParams }) {
  const q = typeof searchParams?.q === 'string' ? searchParams.q : ''
  const initial = await fetchCacheSSR(q)
  
  return (
    <ResultsShell>
      <Suspense fallback={<PageLoader />}>
        <ResultsClient initial={initial} q={q} />
      </Suspense>
    </ResultsShell>
  )
}
```

**–ü–ª—é—Å—ã**:
- Loader –≤–∏–¥–µ–Ω –≤ SSR HTML
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ JavaScript

**–ú–∏–Ω—É—Å—ã**:
- –ù–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∞
- Suspense –Ω–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç D: –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à –¥–ª—è /results

```tsx
async function fetchCacheSSR(q: string) {
  if (!q) return null
  const url = `${proto}://${host}/api/vitrine/list?q=${encodeURIComponent(q)}`
  const res = await fetch(url, {
    cache: 'no-store',
    next: { revalidate: 0 }  // ‚Üê –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏—é
  })
  // ...
}
```

**–ü–ª—é—Å—ã**:
- –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–∞—Å—Ç –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞—Ç—å loader

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ù–ê–†–£–®–ê–ï–¢ –ê–†–•–ò–¢–ï–ö–¢–£–†–£ –ü–†–û–ï–ö–¢–ê
- –£–±–∏–≤–∞–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –∫—ç—à–∞
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API

### –í–∞—Ä–∏–∞–Ω—Ç E: Skeleton Screen –≤–º–µ—Å—Ç–æ loader

–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–º–µ—Å—Ç–æ blur-loader:
```tsx
{isLoading ? (
  <div className="space-y-4">
    {[...Array(5)].map((_, i) => (
      <div key={i} className="glass-card animate-pulse">
        <div className="h-20 bg-muted rounded"></div>
      </div>
    ))}
  </div>
) : (
  <ResultsList rows={rows} />
)}
```

**–ü–ª—é—Å—ã**:
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UX –ø–∞—Ç—Ç–µ—Ä–Ω
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å SSR
- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–ú–∏–Ω—É—Å—ã**:
- –ù–µ —Ç–æ—Ç —ç—Ñ—Ñ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ("–º—É—Ç–Ω–æ–µ —Å—Ç–µ–∫–ª–æ")

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (Quick Fix)
**–£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ 400-500ms**:
```tsx
setTimeout(() => {
  window.location.href = `/results?q=${encodeURIComponent(q)}`
}, 400)
```

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (Better UX)
**–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ router.push() + Suspense**:
```tsx
// app/page.tsx
const router = useRouter()
onSearch={(q) => {
  router.push(`/results?q=${encodeURIComponent(q)}`)
}}

// app/results/page.tsx —É–±—Ä–∞—Ç—å fetchCacheSSR –∏–∑ SSR
// –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å fetch –≤ client component —Å Suspense
```

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (Ideal)
**Skeleton Screen + Progressive Loading**:
1. SSR –æ—Ç–¥–∞—ë—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π layout
2. Skeleton –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
3. –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∏–º—è—Ç—Å—è —á–µ—Ä–µ–∑ SSE
4. –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–ª–∞–≤–Ω–æ –∑–∞–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º–∏

---

## üìù –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### app/page.tsx
```tsx
const [isNavigating, setIsNavigating] = useState(false)

<AutocompleteSearch
  onSearch={(q) => {
    setIsNavigating(true)
    setTimeout(() => {
      window.location.href = `/results?q=${encodeURIComponent(q)}`
    }, 100)
  }}
/>

{isNavigating && <PageLoader />}
```

### components/ResultsClient.tsx
```tsx
const [isLoading, setIsLoading] = useState(true)

useEffect(() => {
  const timer = setTimeout(() => setIsLoading(false), 500)
  return () => clearTimeout(timer)
}, [])

useEffect(() => {
  if (mode !== 'live' || !q) return
  setIsLoading(true)
  const es = new EventSource(`/api/live/search?q=${encodeURIComponent(q)}`)
  es.addEventListener('done', () => { 
    es.close()
    setIsLoading(false)
  })
}, [mode, q])

{isLoading && <PageLoader />}
<div style={{ opacity: isLoading ? 0.3 : 1 }}>
```

### app/results/page.tsx
```tsx
async function fetchCacheSSR(q: string) {
  // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ –∫—ç—à–∞
  const res = await fetch(url, { cache: 'no-store' })
  return res.json()
}

export default async function ResultsPage({ searchParams }) {
  const initial = await fetchCacheSSR(q)  // ‚Üê –î–∞–Ω–Ω—ã–µ —É–∂–µ –≤ SSR
  return <ResultsClient initial={initial} q={q} />
}
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–µ—à–∏—Ç—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º**, –∫–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ:
   - –£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É (–ø—Ä–æ—Å—Ç–æ–µ, –Ω–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–µ)
   - –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ router.push() (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ, —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
   - Skeleton Screen (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ, –¥—Ä—É–≥–æ–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç)

2. **–ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É**: –∏–∑–º–µ–Ω–∏—Ç—å 100ms ‚Üí 500ms –≤ `app/page.tsx`

3. **–ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å router.push()**: 
   - –ó–∞–º–µ–Ω–∏—Ç—å `window.location.href` –Ω–∞ `router.push()`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É `app/loading.tsx`
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ SSR –∫—ç—à –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–∫–æ—Ä–æ—Å—Ç—è—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

5. **–ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å** –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤ commit message

---

## üìå –ö–æ–º–º–∏—Ç—ã –ø–æ —Ç–µ–º–µ

- `748f121` - fix(loader): remove old MicrochipLoader, render content under blur overlay
- `6a0455f` - fix(loader): remove isMounted check that caused white screen
- (—Ç–µ–∫—É—â–∏–π) - feat(loader): add pre-navigation loader on main page

---

**–ê–≤—Ç–æ—Ä –æ—Ç—á—ë—Ç–∞**: GitHub Copilot  
**–î–∞—Ç–∞**: 6 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: –í –æ–∂–∏–¥–∞–Ω–∏–∏ —Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
