{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://deep-agg.com/schemas/order.request.json",
  "title": "Order Request Schema",
  "description": "JSON Schema for POST /api/order request validation",
  "type": "object",
  "required": ["customer", "item"],
  "additionalProperties": false,
  "properties": {
    "customer": {
      "type": "object",
      "required": ["name", "contact"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "minLength": 2,
          "maxLength": 128,
          "description": "Customer full name or company name"
        },
        "contact": {
          "type": "object",
          "additionalProperties": false,
          "minProperties": 1,
          "properties": {
            "email": {
              "type": "string",
              "format": "email",
              "description": "Email address in RFC 5322 format"
            },
            "phone": {
              "type": "string",
              "pattern": "^\\+[1-9]\\d{1,14}$",
              "description": "Phone number in E.164 format (e.g., +79161234567)"
            },
            "telegram": {
              "type": "string",
              "pattern": "^@[a-zA-Z0-9_]{5,32}$",
              "description": "Telegram username starting with @ (e.g., @username)"
            }
          },
          "description": "At least one contact method is required"
        }
      }
    },
    "item": {
      "type": "object",
      "required": ["mpn", "manufacturer", "qty"],
      "additionalProperties": false,
      "properties": {
        "mpn": {
          "type": "string",
          "minLength": 1,
          "maxLength": 64,
          "description": "Manufacturer Part Number"
        },
        "manufacturer": {
          "type": "string",
          "minLength": 1,
          "maxLength": 128,
          "description": "Manufacturer name"
        },
        "qty": {
          "type": "integer",
          "minimum": 1,
          "description": "Quantity to order"
        }
      }
    },
    "pricing_snapshot": {
      "type": "object",
      "required": ["base_price_rub", "markup_percent", "markup_fixed_rub", "final_price_rub"],
      "additionalProperties": false,
      "properties": {
        "base_price_rub": {
          "type": "number",
          "minimum": 0,
          "description": "Base price from supplier in RUB"
        },
        "markup_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Markup as decimal (e.g., 0.30 for 30%)"
        },
        "markup_fixed_rub": {
          "type": "number",
          "minimum": 0,
          "description": "Fixed markup in RUB"
        },
        "final_price_rub": {
          "type": "number",
          "minimum": 0,
          "description": "Final calculated price in RUB"
        }
      },
      "description": "Pricing snapshot at order creation time (optional, will be calculated if not provided)"
    },
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "comment": {
          "type": "string",
          "maxLength": 500,
          "description": "Optional customer comment"
        }
      },
      "description": "Optional metadata"
    }
  }
}
